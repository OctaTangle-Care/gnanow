{% comment %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products - Shop</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        .container { display: flex; }
        .sidebar { width: 20%; padding: 10px; border-right: 1px solid #ccc; }
        .main-content { width: 80%; padding: 10px; }
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .product-card { border: 1px solid #ddd; padding: 10px; border-radius: 8px; text-align: center; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; }
        .filters h4 { margin-top: 20px; }
        .wishlist-btn { color: red; font-size: 20px; cursor: pointer; }
        .search-bar { margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
            <h1>üõí ShopLogo</h1>
            <nav>
                <a href="{% url 'dashboard' %}">Dashboard</a> |
                <a href="{% url 'view_cart' %}">Cart</a> |
                <a href="{% url 'wishlist' %}">Wishlist</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Sidebar filters -->
        <div class="sidebar filters">
            <form method="get">
                <div class="search-bar">
                    <input type="text" name="q" placeholder="Search products..." value="{{ query }}">
                    <button type="submit">Search</button>
                </div>

                <h4>Category</h4>
                {% comment %} {% for category in categories %}
                    <label><input type="checkbox" name="category" value="{{ category.slug }}" {% if category.id|stringformat:"s" in selected_categories %}checked{% endif %}> {{ category.name }}</label><br>
                {% endfor %} {% endcomment %
                 {% for category in categories %}
  <label>
    <input type="checkbox" name="category" value="{{ category.slug }}"
      {% if category.slug in selected_categories %}checked{% endif %}>
    {{ category.name }}
  </label>
{% endfor %}


                <h4>Color</h4>
                {% comment %} {% for color in colors %}
                    <label><input type="checkbox" name="color" value="{{ color }}" {% if color in selected_colors %}checked{% endif %}> {{ color }}</label><br>
                {% endfor %} {% endcomment %
                 {% for code, name in colors %}
  <label>
    <input type="checkbox" name="color" value="{{ code }}"
      {% if code in selected_colors %}checked{% endif %}>
    {{ name }}
  </label>
{% endfor %}


                <h4>Size</h4>
                {% comment %} {% for size in sizes %}
                    <label><input type="checkbox" name="size" value="{{ size }}" {% if size in selected_sizes %}checked{% endif %}> {{ size }}</label><br>
                {% endfor %} {% endcomment %
                 {% for code, name in sizes %}
  <label>
    <input type="checkbox" name="size" value="{{ code }}"
      {% if code in selected_sizes %}checked{% endif %}>
    {{ name }}
  </label>
{% endfor %}


                <h4>Price</h4>
                Min: <input type="number" name="min_price" step="0.01" value="{{ min_price }}"><br>
                Max: <input type="number" name="max_price" step="0.01" value="{{ max_price }}"><br>

                <button type="submit">Apply Filters</button>

<!-- üîÅ Clear Filters Button -->
<a href="{% url 'product_list' %}" style="
    display: inline-block;
    padding: 8px 16px;
    background-color: #f44336;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin-left: 10px;
">
  Clear All Filters
</a>

            </form>
        </div>

        <!-- Products -->
        <div class="main-content">
            <h2>All Products</h2>
            <div class="product-grid">
                {% for product in products %}
                    {% for variant in product.variants.all %}
                        <div class="product-card">
                            {% if variant.images.all %}
                                <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <img src="{% static 'images/no-image.jpg' %}" alt="No image">
                            {% endif %}
                            <h3>{{ product.name }}</h3>
                            <p>‚Çπ{{ variant.price }}</p>
                            <p>‚≠ê {{ product.avg_rating|default:"4.5" }}</p>
                            <span class="wishlist-btn" onclick="location.href='{% url 'toggle_wishlist' variant.id %}'">‚ô•</span>
                            <form action="{% url 'add_to_cart' variant.id %}" method="post">
                                {% csrf_token %}
                                <input type="number" name="quantity" min="1" max="{{ variant.stock }}" value="1">
                                <button type="submit">Add to Cart</button>
                            </form>
                            <a href="{% url 'product_detail' product.slug %}"><button>View Details</button></a>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>

            {% if query or filters_applied %}
                <h2>Filtered Products</h2>
                <div class="product-grid">
                    {% for product in products %}
                        {% for variant in product.variants.all %}
                            <div class="product-card">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}">
                                {% else %}
                                    <img src="{% static 'images/no-image.jpg' %}" alt="No image">
                                {% endif %}
                                <h3>{{ product.name }}</h3>
                                <p>‚Çπ{{ variant.price }}</p>
                                <p>‚≠ê {{ product.avg_rating|default:"4.5" }}</p>
                                <span class="wishlist-btn" onclick="location.href='{% url 'toggle_wishlist' variant.id %}'">‚ô•</span>
                                <form action="{% url 'add_to_cart' variant.id %}" method="post">
                                    {% csrf_token %}
                                    <input type="number" name="quantity" min="1" max="{{ variant.stock }}" value="1">
                                    <button type="submit">Add to Cart</button>
                                </form>
                                <a href="{% url 'product_detail' product.slug %}"><button>View Details</button></a>
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}

            {% if related_products %}
                <h2>Related Products</h2>
                <div class="product-grid">
                    {% for product in related_products %}
                        {% for variant in product.variants.all %}
                            <div class="product-card">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}">
                                {% else %}
                                    <img src="{% static 'images/no-image.jpg' %}" alt="No image">
                                {% endif %}
                                <h3>{{ product.name }}</h3>
                                <p>‚Çπ{{ variant.price }}</p>
                                <p>‚≠ê {{ product.avg_rating|default:"4.5" }}</p>
                                <span class="wishlist-btn" onclick="location.href='{% url 'toggle_wishlist' variant.id %}'">‚ô•</span>
                                <form action="{% url 'add_to_cart' variant.id %}" method="post">
                                    {% csrf_token %}
                                    <input type="number" name="quantity" min="1" max="{{ variant.stock }}" value="1">
                                    <button type="submit">Add to Cart</button>
                                </form>
                                <a href="{% url 'product_detail' product.slug %}"><button>View Details</button></a>
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html> {% endcomment %}


{% comment %} {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="logo">MyShop</div>
        <div class="search-bar">
            <form method="GET" action="{% url 'product_list' %}">
                <input type="text" name="query" placeholder="Search products...">
                <button type="submit">Search</button>
            </form>
        </div>
    </nav>

    <!-- Filter section -->
    <aside>
        <h3>Filter</h3>
        <form method="GET" action="{% url 'product_list' %}">
            <label>Category:</label>
            <select name="category">
                <option value="">All</option>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            <button type="submit">Apply</button>
        </form>
    </aside>

    <!-- Products -->
    <section>
        <h2>{% if query %}Search Results{% else %}All Products{% endif %}</h2>
        <div class="product-grid">
            {% for product in products %}
                <div class="product-card">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    <h3>{{ product.name }}</h3>
                    <p>${{ product.price }}</p>
                    <p>Rating: {{ product.average_rating }}</p>
                    <form method="POST" action="{% url 'add_to_cart' product.id %}">
                        {% csrf_token %}
                        <input type="number" name="quantity" min="1" value="1">
                        <button type="submit">Add to Cart</button>
                    </form>
                    <form method="POST" action="{% url 'toggle_wishlist' product.id %}">
                        {% csrf_token %}
                        <button>‚ù§Ô∏è</button>
                    </form>
                    <a href="">View Details</a>
                </div>
            {% empty %}
                <p>No products found.</p>
            {% endfor %}
        </div>
    </section>

    <!-- Related Products -->
    {% if related_products %}
    <section>
        <h2>Related Products</h2>
        <div class="product-grid">
            {% for product in related_products %}
                <div class="product-card">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    <h3>{{ product.name }}</h3>
                    <p>${{ product.price }}</p>
                    <a href="">View Details</a>
                </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</body>
</html> {% endcomment %}


{% load static %}
{% comment %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <style>
        .product-grid { display: flex; flex-wrap: wrap; gap: 20px; }
        .product-card { width: 23%; border: 1px solid #ccc; padding: 10px; text-align: center; }
        .filters { margin: 20px 0; }
        .nav { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="nav">
    <div class="logo"><h2>MyShop</h2></div>
    <form method="GET" action="{% url 'product_list' %}">
        <input type="text" name="q" placeholder="Search products..." value="{{ request.GET.q }}">
        <button type="submit">Search</button>
    </form>
</div>

<div class="filters">
    <form method="GET" action="{% url 'product_list' %}">
        <select name="category">
            <option value="">All Categories</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
        <select name="color">
            <option value="">All Colors</option>
            {% for color in colors %}
                <option value="{{ color }}" {% if request.GET.color == color %}selected{% endif %}>{{ color }}</option>
            {% endfor %}
        </select>
        <select name="size">
            <option value="">All Sizes</option>
            {% for size in sizes %}
                <option value="{{ size }}" {% if request.GET.size == size %}selected{% endif %}>{{ size }}</option>
            {% endfor %}
        </select>
        <input type="number" name="min_price" placeholder="Min Price" value="{{ request.GET.min_price }}">
        <input type="number" name="max_price" placeholder="Max Price" value="{{ request.GET.max_price }}">
        <button type="submit">Filter</button>
    </form>
</div>

<h3>Products</h3>
<div class="product-grid">
    {% for product in matched_products %}
        <div class="product-card">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" width="100%">
            <h4>{{ product.name }}</h4>
            <p>${{ product.price }}</p>
            <p>‚≠ê {{ product.average_rating }}</p>
            <form method="POST" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <input type="number" name="quantity" value="1" min="1">
                <button type="submit">Add to Cart</button>
            </form>
            <a href="{% url 'toggle_wishlist' product.id %}">‚ù§Ô∏è</a>
            <a href="">View Details</a>
        </div>
    {% empty %}
        <p>No products found.</p>
    {% endfor %}
</div>

{% if related_products %}
<h3>Related Products</h3>
<div class="product-grid">
    {% for product in related_products %}
        <div class="product-card">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" width="100%">
            <h4>{{ product.name }}</h4>
            <p>${{ product.price }}</p>
            <p>‚≠ê {{ product.average_rating }}</p>
            <form method="POST" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <input type="number" name="quantity" value="1" min="1">
                <button type="submit">Add to Cart</button>
            </form>
            <a href="{% url 'toggle_wishlist' product.id %}">‚ù§Ô∏è</a>
            <a href="">View Details</a>
        </div>
    {% endfor %}
</div>
{% endif %}

</body>
</html>




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products - Shop</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        /* Minimal styling */
        .container { display: flex; }
        .sidebar { width: 20%; padding: 10px; border-right: 1px solid #ccc; }
        .main-content { width: 80%; padding: 10px; }
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .product-card { border: 1px solid #ddd; padding: 10px; border-radius: 8px; text-align: center; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; }
        .filters h4 { margin-top: 20px; }
        .wishlist-btn { color: red; font-size: 20px; cursor: pointer; }
        .search-bar { margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
            <h1>üõçÔ∏è ShopLogo</h1>
            <nav>
                <a href="{% url 'dashboard' %}">Dashboard</a> |
                <a href="{% url 'view_cart' %}">Cart</a> |
                <a href="{% url 'wishlist' %}">Wishlist</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Sidebar filters -->
        <div class="sidebar filters">
            <form method="get">
                <div class="search-bar">
                    <input type="text" name="q" placeholder="Search products..." value="{{ query }}">
                    <button type="submit">Search</button>
                </div>

                <h4>Category</h4>
                {% for category in categories %}
                    <label><input type="checkbox" name="category" value="{{ category.id }}" {% if category.id|stringformat:"s" in selected_categories %}checked{% endif %}> {{ category.name }}</label><br>
                {% endfor %}

                <h4>Color</h4>
                {% for color in colors %}
                    <label><input type="checkbox" name="color" value="{{ color }}" {% if color in selected_colors %}checked{% endif %}> {{ color }}</label><br>
                {% endfor %}

                <h4>Size</h4>
                {% for size in sizes %}
                    <label><input type="checkbox" name="size" value="{{ size }}" {% if size in selected_sizes %}checked{% endif %}> {{ size }}</label><br>
                {% endfor %}

                <h4>Price</h4>
                Min: <input type="number" name="min_price" step="0.01" value="{{ min_price }}"><br>
                Max: <input type="number" name="max_price" step="0.01" value="{{ max_price }}"><br>

                <button type="submit">Apply Filters</button>
            </form>
        </div>

        <!-- Products -->
        <div class="main-content">
            {% if query %}
                <h2>Search Results for "{{ query }}"</h2>
            {% endif %}

            <div class="product-grid">
                {% for product in products %}
                    {% for variant in product.variants.all %}
                        <div class="product-card">
                            {% if variant.images.all %}
                                <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <img src="{% static 'images/no-image.jpg' %}" alt="No image">
                            {% endif %}
                            <h3>{{ product.name }}</h3>
                            <p>‚Çπ{{ variant.price }}</p>
                            <p>‚≠ê {{ product.avg_rating|default:"4.5" }}</p> <!-- assuming rating field -->
                            <span class="wishlist-btn" onclick="location.href='{% url 'toggle_wishlist' variant.id %}'">‚ô•</span>
                            <form action="{% url 'add_to_cart' variant.id %}" method="post">
                                {% csrf_token %}
                                <input type="number" name="quantity" min="1" max="{{ variant.stock }}" value="1">
                                <button type="submit">Add to Cart</button>
                            </form>
                            <a href=""><button>View Details</button></a>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>

            {% if related_products %}
                <h2>Related Products</h2>
                <div class="product-grid">
                    {% for product in related_products %}
                        {% for variant in product.variants.all %}
                            <div class="product-card">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}">
                                {% else %}
                                    <img src="{% static 'images/no-image.jpg' %}" alt="No image">
                                {% endif %}
                                <h3>{{ product.name }}</h3>
                                <p>‚Çπ{{ variant.price }}</p>
                                <p>‚≠ê {{ product.avg_rating|default:"4.5" }}</p>
                                <span class="wishlist-btn" onclick="location.href='{% url 'toggle_wishlist' variant.id %}'">‚ô•</span>
                                <form action="{% url 'add_to_cart' variant.id %}" method="post">
                                    {% csrf_token %}
                                    <input type="number" name="quantity" min="1" max="{{ variant.stock }}" value="1">
                                    <button type="submit">Add to Cart</button>
                                </form>
                                <a href=""><button>View Details</button></a>
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html> {% endcomment %}



{% comment %} 


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none; /* Prevents pull-to-refresh issues on mobile affecting layout */
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Additional style for heart icon if needed */
        .wishlist-btn svg {
            transition: transform 0.2s ease-in-out, fill 0.2s ease-in-out;
        }
        .wishlist-btn:hover svg {
            transform: scale(1.2);
        }
        .wishlist-btn.active svg {
            fill: #ef4444; /* Red color for active wishlist */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#3B82F6', // Blue-500
                        secondary: '#10B981', // Emerald-500
                        accent: '#F59E0B', // Amber-500
                    },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s ease-in-out infinite',
                    },
                    keyframes: {
                        'subtle-bounce': {
                            '0%, 100%': { transform: 'translateY(-2%)' },
                            '50%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <a href="{% url 'product_list' %}" class="text-3xl font-bold text-primary hover:text-blue-700 transition-colors">
                    üõí ShopLogo
                </a>
                <nav class="space-x-4">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Dashboard</a>
                    <a href="{% url 'view_cart' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Cart</a>
                    <a href="{% url 'wishlist' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Wishlist</a>
                    </nav>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4 xl:w-1/5 p-6 bg-white rounded-lg shadow-lg animate-fade-in">
                <form method="get" action="{% url 'product_list' %}"> <div class="mb-6">
                        <label for="search-input" class="block text-xl font-semibold text-gray-700 mb-2">Search</label>
                        <div class="relative">
                            <input type="text" id="search-input" name="q" placeholder="Search products..." value="{{ query }}"
                                   class="w-full px-4 py-2.5 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-shadow duration-300 ease-in-out shadow-sm hover:shadow-md focus:shadow-lg">
                            <button type="submit" class="absolute right-0 top-0 bottom-0 px-4 text-white bg-primary hover:bg-blue-700 rounded-r-lg transition-colors flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Category</h4>
                            <div class="space-y-2 max-h-60 overflow-y-auto pr-2">
                                {% for category in categories %}
                                <label class="flex items-center space-x-2 text-gray-600 hover:text-primary cursor-pointer">
                                    <input type="checkbox" name="category" value="{{ category.slug }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition"
                                           {% if category.slug in selected_categories %}checked{% endif %}>
                                    <span>{{ category.name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No categories available.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Color</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                                {% for code, name in colors %}
                                <label class="flex items-center space-x-2 text-gray-600 hover:text-primary cursor-pointer">
                                    <input type="checkbox" name="color" value="{{ code }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition"
                                           {% if code in selected_colors %}checked{% endif %}>
                                    <span>{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No colors available.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Size</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                                {% for code, name in sizes %}
                                <label class="flex items-center space-x-2 text-gray-600 hover:text-primary cursor-pointer">
                                    <input type="checkbox" name="size" value="{{ code }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition"
                                           {% if code in selected_sizes %}checked{% endif %}>
                                    <span>{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No sizes available.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Price Range</h4>
                            <div class="space-y-3">
                                <div>
                                    <label for="min_price" class="block text-sm font-medium text-gray-600">Min Price (‚Çπ)</label>
                                    <input type="number" name="min_price" id="min_price" step="0.01" value="{{ min_price }}"
                                           class="mt-1 w-full px-3 py-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-md focus:ring-primary focus:border-primary transition shadow-sm">
                                </div>
                                <div>
                                    <label for="max_price" class="block text-sm font-medium text-gray-600">Max Price (‚Çπ)</label>
                                    <input type="number" name="max_price" id="max_price" step="0.01" value="{{ max_price }}"
                                           class="mt-1 w-full px-3 py-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-md focus:ring-primary focus:border-primary transition shadow-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 space-y-3">
                        <button type="submit"
                                class="w-full bg-primary text-white py-2.5 px-4 rounded-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out shadow-md hover:shadow-lg">
                            Apply Filters
                        </button>
                        <a href="{% url 'product_list' %}"
                           class="block w-full text-center bg-red-500 text-white py-2.5 px-4 rounded-lg font-semibold hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out shadow-md hover:shadow-lg">
                            Clear All Filters
                        </a>
                    </div>
                </form>
            </aside>

            <main class="w-full lg:w-3/4 xl:w-4/5">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Filtered Products
                        {% else %}
                            All Products
                        {% endif %}
                    </h2>
                    {% if products.has_other_pages %}
                    <p class="text-sm text-gray-600 mt-1">Showing page {{ products.number }} of {{ products.paginator.num_pages }}</p>
                    {% endif %}
                </div>

                {% if products %}
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {% for product in products %}
                        {% for variant in product.variants.all %} <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300 ease-in-out flex flex-col animate-fade-in" >
                            <a href="{% url 'product_detail' product.slug %}" class="block">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }} - {{variant.color_name}} {{variant.size}}"
                                         class="w-full h-56 object-cover transition-opacity duration-300 hover:opacity-90"
                                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image';">
                                {% else %}
                                    <img src="https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image" alt="No image available"
                                         class="w-full h-56 object-cover">
                                {% endif %}
                            </a>
                            <div class="p-5 flex flex-col flex-grow">
                                <h3 class="text-lg font-semibold text-gray-800 mb-1 truncate" title="{{ product.name }}">
                                    <a href="{% url 'product_detail' product.slug %}" class="hover:text-primary">{{ product.name }}</a>
                                </h3>
                                {% if variant.color_name or variant.size %}
                                <p class="text-sm text-gray-500 mb-2 truncate">
                                    {{ variant.color_name|default:'' }} {{ variant.size|default:'' }}
                                </p>
                                {% endif %}
                                <p class="text-xl font-bold text-primary mb-2">‚Çπ{{ variant.price }}</p>
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm text-amber-500 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        {{ product.avg_rating|default:"4.5" }}
                                    </p>
                                    <button class="wishlist-btn text-gray-400 hover:text-red-500 p-1 rounded-full {% if variant.id in wishlist_variant_ids %}active text-red-500{% endif %}"
                                            onclick="toggleWishlist(this, '{% url 'toggle_wishlist' variant.id %}')"
                                            title="Add to Wishlist">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                        </svg>
                                    </button>
                                </div>

                                <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto space-y-2">
                                    {% csrf_token %}
                                    <div class="flex items-center space-x-2">
                                        <label for="quantity-{{variant.id}}" class="sr-only">Quantity</label>
                                        <input type="number" id="quantity-{{variant.id}}" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1"
                                               class="w-16 px-2 py-1.5 border border-gray-300 rounded-md text-center focus:ring-primary focus:border-primary text-sm">
                                        <button type="submit"
                                                class="flex-1 bg-secondary text-white py-2 px-3 rounded-md font-medium hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 text-sm">
                                            Add to Cart
                                        </button>
                                    </div>
                                </form>
                                <a href="{% url 'product_detail' product.slug %}"
                                   class="mt-2 block text-center w-full bg-gray-200 text-gray-700 py-2 px-3 rounded-md font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition-colors text-sm">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12 animate-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 12c0 3.314-1.686 6.24-4.2 7.995M3 12c0 3.314 1.686 6.24 4.2 7.995" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.5 14.5l-1.5-1.5M8.5 14.5l1.5-1.5" />
                    </svg>
                    <h3 class="mt-2 text-2xl font-semibold text-gray-700">No Products Found</h3>
                    <p class="mt-1 text-gray-500">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Try adjusting your filters or search terms.
                        {% else %}
                            There are currently no products to display. Check back later!
                        {% endif %}
                    </p>
                    {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                    <a href="{% url 'product_list' %}"
                       class="mt-6 inline-block bg-primary text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out shadow-md hover:shadow-lg">
                        Clear Filters & Search
                    </a>
                    {% endif %}
                </div>
                {% endif %}

                {% if products.has_other_pages %}
                <nav class="mt-12 flex items-center justify-between border-t border-gray-200 px-4 sm:px-0" aria-label="Pagination">
                    <div class="-mt-px flex w-0 flex-1">
                        {% if products.has_previous %}
                        <a href="?page={{ products.previous_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 transition-colors">
                            <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                            </svg>
                            Previous
                        </a>
                        {% endif %}
                    </div>
                    <div class="hidden md:-mt-px md:flex">
                        {% for i in products.paginator.page_range %}
                            {% if products.number == i %}
                            <span class="inline-flex items-center border-t-2 border-primary px-4 pt-4 text-sm font-medium text-primary" aria-current="page">{{ i }}</span>
                            {% elif i > products.number|add:'-3' and i < products.number|add:'3' %}
                            <a href="?page={{ i }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                               class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 transition-colors">{{ i }}</a>
                            {% elif i == products.number|add:'-3' or i == products.number|add:'3' %}
                            <span class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500">...</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="-mt-px flex w-0 flex-1 justify-end">
                        {% if products.has_next %}
                        <a href="?page={{ products.next_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 transition-colors">
                            Next
                            <svg class="ml-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </nav>
                {% endif %}

                {% if related_products %}
                <div class="mt-16">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Related Products</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {% for product in related_products %}
                            {% for variant in product.variants.all %}
                            <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300 ease-in-out flex flex-col animate-fade-in">
                                <a href="{% url 'product_detail' product.slug %}" class="block">
                                    {% if variant.images.all %}
                                        <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}" class="w-full h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image';">
                                    {% else %}
                                        <img src="https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image" alt="No image available" class="w-full h-56 object-cover">
                                    {% endif %}
                                </a>
                                <div class="p-5 flex flex-col flex-grow">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-1 truncate"><a href="{% url 'product_detail' product.slug %}" class="hover:text-primary">{{ product.name }}</a></h3>
                                    <p class="text-xl font-bold text-primary mb-2">‚Çπ{{ variant.price }}</p>
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="text-sm text-amber-500 flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                            {{ product.avg_rating|default:"4.5" }}
                                        </p>
                                         <button class="wishlist-btn text-gray-400 hover:text-red-500 p-1 rounded-full {% if variant.id in wishlist_variant_ids %}active text-red-500{% endif %}"
                                            onclick="{% url 'toggle_wishlist' variant.id %}"
                                            title="Add to Wishlist">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                        </button>
                                    </div>
                                    <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto space-y-2">
                                        {% csrf_token %}
                                        <div class="flex items-center space-x-2">
                                            <input type="number" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1" class="w-16 px-2 py-1.5 border border-gray-300 rounded-md text-center focus:ring-primary focus:border-primary text-sm">
                                            <button type="submit" class="flex-1 bg-secondary text-white py-2 px-3 rounded-md font-medium hover:bg-emerald-600 transition-transform transform hover:scale-105 text-sm">Add to Cart</button>
                                        </div>
                                    </form>
                                     <a href="{% url 'product_detail' product.slug %}" class="mt-2 block text-center w-full bg-gray-200 text-gray-700 py-2 px-3 rounded-md font-medium hover:bg-gray-300 transition-colors text-sm">View Details</a>
                                </div>
                            </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </main>
        </div>
    </div>

    <footer class="bg-gray-800 text-gray-300 mt-16 py-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-semibold text-white mb-4">ShopLogo</h3>
                    <p class="text-sm">Your one-stop shop for amazing products. We are committed to providing quality and value.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-primary transition-colors">About Us</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Contact</a></li>
                        <li><a href="{% url 'product_list' %}" class="hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">FAQs</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect With Us</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M12 2.04c-5.5 0-9.96 4.46-9.96 9.96s4.46 9.96 9.96 9.96c5.5 0 9.96-4.46 9.96-9.96S17.5 2.04 12 2.04zm4.37 7.54h-2.5V8.4c0-.52.37-.94.94-.94h1.56V5.2H14.4c-2.1 0-3.75 1.66-3.75 3.75v1.19h-2.5v2.34h2.5V18h2.97v-5.77h2.03l.47-2.34z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07A4.48 4.48 0 0016.27 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.22-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 01-1.93.07 4.28 4.28 0 004 2.98 8.521 8.521 0 01-5.33 1.84c-.34 0-.68-.02-1.01-.06A12.079 12.079 0 008.29 20c7.55 0 11.67-6.25 11.67-11.67v-.53c.8-.58 1.49-1.3 2.05-2.12z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2m-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 011.25 1.25A1.25 1.25 0 0117.25 8 1.25 1.25 0 0116 6.75a1.25 1.25 0 011.25-1.25M12 7a5 5 0 015 5 5 5 0 01-5 5 5 5 0 01-5-5 5 5 0 015-5m0 2a3 3 0 00-3 3 3 3 0 003 3 3 3 0 003-3 3 3 0 00-3-3z"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} ShopLogo. All rights reserved.</p>
                <p class="mt-1">Designed with <span class="text-red-500">‚ô•</span> using Tailwind CSS.</p>
            </div>
        </div>
    </footer>

    <script>
        // Basic Wishlist Toggle Example (client-side visual only, backend handles actual logic)
        // You'll need to ensure `wishlist_variant_ids` is passed to your template context
        // or fetch the wishlist status via an API if you want it to be more robust.
        {% comment %} function toggleWishlist(button, url) {
            // Optimistically toggle UI
            const isActive = button.classList.toggle('active');
            const svg = button.querySelector('svg');
            if (isActive) {
                svg.setAttribute('fill', '#ef4444'); // Red for active
                svg.classList.add('animate-subtle-bounce');
            } else {
                svg.setAttribute('fill', 'none');
                svg.classList.remove('animate-subtle-bounce');
            }

            // Make the actual request to the server
            fetch(url, {
                method: 'GET', // Or 'POST' depending on your Django view
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // Important if POST and CSRF protected
                    'X-Requested-With': 'XMLHttpRequest' // To identify AJAX requests in Django
                }
            })
            .then(response => response.json())
            .then(data => {
                // Update UI based on server response if needed (e.g., if optimistic update was wrong)
                console.log('Wishlist toggle response:', data);
                if (data.status === 'success') {
                    if (data.added) {
                        button.classList.add('active');
                        svg.setAttribute('fill', '#ef4444');
                        svg.classList.add('animate-subtle-bounce');
                    } else {
                        button.classList.remove('active');
                        svg.setAttribute('fill', 'none');
                        svg.classList.remove('animate-subtle-bounce');
                    }
                } else {
                    // Revert optimistic update if server failed
                    button.classList.toggle('active'); // Revert class
                     if (button.classList.contains('active')) {
                        svg.setAttribute('fill', '#ef4444');
                        svg.classList.add('animate-subtle-bounce');
                    } else {
                        svg.setAttribute('fill', 'none');
                        svg.classList.remove('animate-subtle-bounce');
                    }
                    alert('Failed to update wishlist. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error toggling wishlist:', error);
                // Revert optimistic update on error
                button.classList.toggle('active'); // Revert class
                if (button.classList.contains('active')) {
                    svg.setAttribute('fill', '#ef4444');
                    svg.classList.add('animate-subtle-bounce');
                } else {
                    svg.setAttribute('fill', 'none');
                    svg.classList.remove('animate-subtle-bounce');
                }
                alert('An error occurred. Please try again.');
            });
        } {% endcomment %

        // Fallback for image errors - already handled by `onerror` in HTML
        // document.addEventListener('DOMContentLoaded', function() {
        //     const images = document.querySelectorAll('.product-card img');
        //     images.forEach(img => {
        //         img.onerror = function() {
        //             this.onerror = null; // prevent infinite loop if placeholder also fails
        //             this.src = 'https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image';
        //         };
        //     });
        // });

        // Smooth scroll to top button (optional)
        const toTopButton = document.createElement('button');
        toTopButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" /></svg>`;
        toTopButton.className = 'fixed bottom-6 right-6 bg-primary text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300 ease-in-out opacity-0 transform translate-y-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50';
        toTopButton.style.zIndex = '1000';
        toTopButton.style.visibility = 'hidden';

        document.body.appendChild(toTopButton);

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                toTopButton.style.opacity = '1';
                toTopButton.style.transform = 'translateY(0)';
                toTopButton.style.visibility = 'visible';
            } else {
                toTopButton.style.opacity = '0';
                toTopButton.style.transform = 'translateY(1rem)';
                setTimeout(() => { // Hide after transition
                    if (window.scrollY <= 300) toTopButton.style.visibility = 'hidden';
                }, 300);
            }
        });

        toTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

    </script>

</body>
</html> {% endcomment %}

{% comment %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none; /* Prevents pull-to-refresh issues on mobile affecting layout */
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wishlist-btn svg {
            transition: transform 0.2s ease-in-out, fill 0.2s ease-in-out;
        }
        .wishlist-btn:hover svg {
            transform: scale(1.2);
        }
        .wishlist-btn.active svg {
            fill: #ef4444; /* Red color for active wishlist - standard UX */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // Gnanow Brand Colors
                        primary: '#0284C7', // Tailwind sky-600
                        secondary: '#14B8A6', // Tailwind teal-500
                        accent: '#F97316', // Tailwind orange-500
                        
                        // You can still use default Tailwind colors by their names, e.g. colors.red['500']
                        // Example: 'gnanow-primary': '#0284C7',
                        //          'gnanow-secondary': '#14B8A6',
                        //          'gnanow-accent': '#F97316',
                    },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s ease-in-out infinite',
                    },
                    keyframes: {
                        'subtle-bounce': {
                            '0%, 100%': { transform: 'translateY(-2%)' },
                            '50%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <a href="{% url 'product_list' %}" class="text-3xl font-bold text-primary hover:text-sky-700 transition-colors">
                    üõí ShopLogo
                </a>
                <nav class="space-x-4">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Dashboard</a>
                    <a href="{% url 'view_cart' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Cart</a>
                    <a href="{% url 'wishlist' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Wishlist</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4 xl:w-1/5 p-6 bg-white rounded-lg shadow-lg animate-fade-in">
                <form method="get" action="{% url 'product_list' %}">
                    <div class="mb-6">
                        <label for="search-input" class="block text-xl font-semibold text-gray-700 mb-2">Search</label>
                        <div class="relative">
                            <input type="text" id="search-input" name="q" placeholder="Search products..." value="{{ query }}"
                                   class="w-full px-4 py-2.5 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-shadow duration-300 ease-in-out shadow-sm hover:shadow-md focus:shadow-lg">
                            <button type="submit" class="absolute right-0 top-0 bottom-0 px-4 text-white bg-primary hover:bg-sky-700 rounded-r-lg transition-colors flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Category</h4>
                            <div class="space-y-2 max-h-60 overflow-y-auto pr-2">
                                {% for category in categories %}
                                <label class="flex items-center space-x-2 text-gray-600 hover:text-primary cursor-pointer">
                                    <input type="checkbox" name="category" value="{{ category.slug }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition"
                                           {% if category.slug in selected_categories %}checked{% endif %}>
                                    <span>{{ category.name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No categories available.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Color</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                                {% for code, name in colors %}
                                <label class="flex items-center space-x-2 text-gray-600 hover:text-primary cursor-pointer">
                                    <input type="checkbox" name="color" value="{{ code }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition"
                                           {% if code in selected_colors %}checked{% endif %}>
                                    <span>{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No colors available.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Size</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                                {% for code, name in sizes %}
                                <label class="flex items-center space-x-2 text-gray-600 hover:text-primary cursor-pointer">
                                    <input type="checkbox" name="size" value="{{ code }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition"
                                           {% if code in selected_sizes %}checked{% endif %}>
                                    <span>{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No sizes available.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Price Range</h4>
                            <div class="space-y-3">
                                <div>
                                    <label for="min_price" class="block text-sm font-medium text-gray-600">Min Price (‚Çπ)</label>
                                    <input type="number" name="min_price" id="min_price" step="0.01" value="{{ min_price }}"
                                           class="mt-1 w-full px-3 py-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-md focus:ring-primary focus:border-primary transition shadow-sm">
                                </div>
                                <div>
                                    <label for="max_price" class="block text-sm font-medium text-gray-600">Max Price (‚Çπ)</label>
                                    <input type="number" name="max_price" id="max_price" step="0.01" value="{{ max_price }}"
                                           class="mt-1 w-full px-3 py-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-md focus:ring-primary focus:border-primary transition shadow-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 space-y-3">
                        <button type="submit"
                                class="w-full bg-primary text-white py-2.5 px-4 rounded-lg font-semibold hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out shadow-md hover:shadow-lg">
                            Apply Filters
                        </button>
                        <a href="{% url 'product_list' %}"
                           class="block w-full text-center bg-red-500 text-white py-2.5 px-4 rounded-lg font-semibold hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out shadow-md hover:shadow-lg">
                            Clear All Filters
                        </a>
                    </div>
                </form>
            </aside>

            <main class="w-full lg:w-3/4 xl:w-4/5">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Filtered Products
                        {% else %}
                            All Products
                        {% endif %}
                    </h2>
                    {% if products.has_other_pages %}
                    <p class="text-sm text-gray-600 mt-1">Showing page {{ products.number }} of {{ products.paginator.num_pages }}</p>
                    {% endif %}
                </div>

                {% if products %}
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {% for product in products %}
                        {% for variant in product.variants.all %}
                        <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300 ease-in-out flex flex-col animate-fade-in" >
                            <a href="{% url 'product_detail' product.slug %}" class="block">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }} - {{variant.color_name}} {{variant.size}}"
                                         class="w-full h-56 object-cover transition-opacity duration-300 hover:opacity-90"
                                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image';">
                                {% else %}
                                    <img src="https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image" alt="No image available"
                                         class="w-full h-56 object-cover">
                                {% endif %}
                            </a>
                            <div class="p-5 flex flex-col flex-grow">
                                <h3 class="text-lg font-semibold text-gray-800 mb-1 truncate" title="{{ product.name }}">
                                    <a href="{% url 'product_detail' product.slug %}" class="hover:text-primary">{{ product.name }}</a>
                                </h3>
                                {% if variant.color_name or variant.size %}
                                <p class="text-sm text-gray-500 mb-2 truncate">
                                    {{ variant.color_name|default:'' }} {{ variant.size|default:'' }}
                                </p>
                                {% endif %}
                                <p class="text-xl font-bold text-primary mb-2">‚Çπ{{ variant.price }}</p>
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm text-accent flex items-center"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        {{ product.avg_rating|default:"4.5" }}
                                    </p>
                                    <button class="wishlist-btn text-gray-400 hover:text-red-500 p-1 rounded-full {% if variant.id in wishlist_variant_ids %}active text-red-500{% endif %}"
                                            onclick="toggleWishlist(this, '{% url 'toggle_wishlist' variant.id %}')"
                                            title="Add to Wishlist">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                        </svg>
                                    </button>
                                </div>

                                <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
                                    {% csrf_token %}
                                    <div class="flex items-stretch">
                                        <label for="quantity-{{variant.id}}" class="sr-only">Quantity</label>
                                        <input type="number" id="quantity-{{variant.id}}" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1"
                                               class="w-20 px-2 py-2 border border-r-0 border-gray-300 rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
                                        <button type="submit"
                                                class="flex-grow bg-primary text-white px-3 py-2 rounded-r-md font-medium hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-colors duration-150 ease-in-out text-sm flex items-center justify-center space-x-2 transform hover:scale-105">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                            </svg>
                                            <span>Add to Cart</span>
                                        </button>
                                    </div>
                                </form>
                                <a href="{% url 'product_detail' product.slug %}"
                                   class="mt-3 block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-medium hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-50 transition-colors text-sm transform hover:scale-105">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12 animate-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 12c0 3.314-1.686 6.24-4.2 7.995M3 12c0 3.314 1.686 6.24 4.2 7.995" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.5 14.5l-1.5-1.5M8.5 14.5l1.5-1.5" />
                    </svg>
                    <h3 class="mt-2 text-2xl font-semibold text-gray-700">No Products Found</h3>
                    <p class="mt-1 text-gray-500">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Try adjusting your filters or search terms.
                        {% else %}
                            There are currently no products to display. Check back later!
                        {% endif %}
                    </p>
                    {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                    <a href="{% url 'product_list' %}"
                       class="mt-6 inline-block bg-primary text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out shadow-md hover:shadow-lg">
                        Clear Filters & Search
                    </a>
                    {% endif %}
                </div>
                {% endif %}

                {% if products.has_other_pages %}
                <nav class="mt-12 flex items-center justify-between border-t border-gray-200 px-4 sm:px-0" aria-label="Pagination">
                    <div class="-mt-px flex w-0 flex-1">
                        {% if products.has_previous %}
                        <a href="?page={{ products.previous_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 transition-colors">
                            <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                            </svg>
                            Previous
                        </a>
                        {% endif %}
                    </div>
                    <div class="hidden md:-mt-px md:flex">
                        {% for i in products.paginator.page_range %}
                            {% if products.number == i %}
                            <span class="inline-flex items-center border-t-2 border-primary px-4 pt-4 text-sm font-medium text-primary" aria-current="page">{{ i }}</span>
                            {% elif i > products.number|add:'-3' and i < products.number|add:'3' %}
                            <a href="?page={{ i }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                               class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 transition-colors">{{ i }}</a>
                            {% elif i == products.number|add:'-3' or i == products.number|add:'3' %}
                            <span class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500">...</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="-mt-px flex w-0 flex-1 justify-end">
                        {% if products.has_next %}
                        <a href="?page={{ products.next_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 transition-colors">
                            Next
                            <svg class="ml-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </nav>
                {% endif %}

                {% if related_products %}
                <div class="mt-16">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Related Products</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {% for product in related_products %}
                            {% for variant in product.variants.all %}
                            <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300 ease-in-out flex flex-col animate-fade-in" >
                                <a href="{% url 'product_detail' product.slug %}" class="block">
                                    {% if variant.images.all %}
                                        <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}" class="w-full h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image';">
                                    {% else %}
                                        <img src="https://placehold.co/400x300/E2E8F0/94A3B8?text=No+Image" alt="No image available" class="w-full h-56 object-cover">
                                    {% endif %}
                                </a>
                                <div class="p-5 flex flex-col flex-grow">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-1 truncate"><a href="{% url 'product_detail' product.slug %}" class="hover:text-primary">{{ product.name }}</a></h3>
                                    <p class="text-xl font-bold text-primary mb-2">‚Çπ{{ variant.price }}</p>
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="text-sm text-accent flex items-center"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                            {{ product.avg_rating|default:"4.5" }}
                                        </p>
                                         <button class="wishlist-btn text-gray-400 hover:text-red-500 p-1 rounded-full {% if variant.id in wishlist_variant_ids %}active text-red-500{% endif %}"
                                            onclick="toggleWishlist(this, '{% url 'toggle_wishlist' variant.id %}')"
                                            title="Add to Wishlist">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                        </button>
                                    </div>
                                    <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
                                        {% csrf_token %}
                                        <div class="flex items-stretch">
                                            <input type="number" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1" class="w-20 px-2 py-2 border border-r-0 border-gray-300 rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
                                            <button type="submit" class="flex-grow bg-primary text-white px-3 py-2 rounded-r-md font-medium hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-colors duration-150 ease-in-out text-sm flex items-center justify-center space-x-2 transform hover:scale-105">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                                <span>Add to Cart</span>
                                            </button>
                                        </div>
                                    </form>
                                     <a href="{% url 'product_detail' product.slug %}" class="mt-3 block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-medium hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-50 transition-colors text-sm transform hover:scale-105">View Details</a>
                                </div>
                            </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </main>
        </div>
    </div>

    <footer class="bg-gray-800 text-gray-300 mt-16 py-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-semibold text-white mb-4">ShopLogo</h3>
                    <p class="text-sm">Your one-stop shop for amazing products. We are committed to providing quality and value.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-primary transition-colors">About Us</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Contact</a></li>
                        <li><a href="{% url 'product_list' %}" class="hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">FAQs</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect With Us</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M12 2.04c-5.5 0-9.96 4.46-9.96 9.96s4.46 9.96 9.96 9.96c5.5 0 9.96-4.46 9.96-9.96S17.5 2.04 12 2.04zm4.37 7.54h-2.5V8.4c0-.52.37-.94.94-.94h1.56V5.2H14.4c-2.1 0-3.75 1.66-3.75 3.75v1.19h-2.5v2.34h2.5V18h2.97v-5.77h2.03l.47-2.34z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07A4.48 4.48 0 0016.27 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.22-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 01-1.93.07 4.28 4.28 0 004 2.98 8.521 8.521 0 01-5.33 1.84c-.34 0-.68-.02-1.01-.06A12.079 12.079 0 008.29 20c7.55 0 11.67-6.25 11.67-11.67v-.53c.8-.58 1.49-1.3 2.05-2.12z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2m-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 011.25 1.25A1.25 1.25 0 0117.25 8 1.25 1.25 0 0116 6.75a1.25 1.25 0 011.25-1.25M12 7a5 5 0 015 5 5 5 0 01-5 5 5 5 0 01-5-5 5 5 0 015-5m0 2a3 3 0 00-3 3 3 3 0 003 3 3 3 0 003-3 3 3 0 00-3-3z"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} ShopLogo. All rights reserved.</p>
                <p class="mt-1">Designed with <span class="text-red-500">‚ô•</span> using Tailwind CSS.</p>
            </div>
        </div>
    </footer>

    <script>
        function toggleWishlist(button, url) {
            const isActive = button.classList.toggle('active');
            const svg = button.querySelector('svg');
            if (isActive) {
                svg.setAttribute('fill', '#ef4444'); 
                svg.classList.add('animate-subtle-bounce');
            } else {
                svg.setAttribute('fill', 'none');
                svg.classList.remove('animate-subtle-bounce');
            }

            fetch(url, {
                method: 'GET', 
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', 
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Wishlist toggle response:', data);
                if (data.status === 'success') {
                    if (data.added) {
                        button.classList.add('active');
                        svg.setAttribute('fill', '#ef4444');
                        svg.classList.add('animate-subtle-bounce');
                    } else {
                        button.classList.remove('active');
                        svg.setAttribute('fill', 'none');
                        svg.classList.remove('animate-subtle-bounce');
                    }
                } else {
                    button.classList.toggle('active'); 
                     if (button.classList.contains('active')) {
                        svg.setAttribute('fill', '#ef4444');
                        svg.classList.add('animate-subtle-bounce');
                    } else {
                        svg.setAttribute('fill', 'none');
                        svg.classList.remove('animate-subtle-bounce');
                    }
                    console.error('Failed to update wishlist. Please try again. Server response:', data.message || 'No message');
                }
            })
            .catch(error => {
                console.error('Error toggling wishlist:', error);
                button.classList.toggle('active'); 
                if (button.classList.contains('active')) {
                    svg.setAttribute('fill', '#ef4444');
                    svg.classList.add('animate-subtle-bounce');
                } else {
                    svg.setAttribute('fill', 'none');
                    svg.classList.remove('animate-subtle-bounce');
                }
                console.error('An error occurred while updating wishlist. Please try again.');
            });
        }

        const toTopButton = document.createElement('button');
        toTopButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" /></svg>`;
        toTopButton.className = 'fixed bottom-6 right-6 bg-primary text-white p-3 rounded-full shadow-lg hover:bg-sky-700 transition-all duration-300 ease-in-out opacity-0 transform translate-y-4 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50';
        toTopButton.style.zIndex = '1000';
        toTopButton.style.visibility = 'hidden';

        document.body.appendChild(toTopButton);

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                toTopButton.style.opacity = '1';
                toTopButton.style.transform = 'translateY(0)';
                toTopButton.style.visibility = 'visible';
            } else {
                toTopButton.style.opacity = '0';
                toTopButton.style.transform = 'translateY(1rem)';
                setTimeout(() => { 
                    if (window.scrollY <= 300) toTopButton.style.visibility = 'hidden';
                }, 300);
            }
        });

        toTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

    </script>

</body>
</html> {% endcomment %}

{% comment %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Gnanow Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #edf2f7; /* Tailwind gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0aec0; /* Tailwind gray-500 */
            border-radius: 10px;
            border: 2px solid #edf2f7; /* Tailwind gray-200 - creates padding */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* Tailwind gray-600 */
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wishlist-btn svg {
            transition: transform 0.25s ease-in-out, fill 0.25s ease-in-out;
        }
        .wishlist-btn:hover svg {
            transform: scale(1.15);
        }
        /* This CSS rule is crucial for the heart to be filled red when .active class is present */
        .wishlist-btn.active svg {
            fill: #ef4444; /* Red-500 for active wishlist */
        }

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', "Noto Sans", 'sans-serif', "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"],
                    },
                    colors: {
                        // Gnanow Brand Colors
                        primary: {
                            DEFAULT: '#0284C7', // sky-600
                            light: '#03A9F4', // A lighter shade for hover or accents
                            dark: '#01579B',  // A darker shade for active states
                        },
                        secondary: {
                            DEFAULT: '#14B8A6', // teal-500
                            light: '#4DB6AC',
                            dark: '#00796B',
                        },
                        accent: {
                            DEFAULT: '#F97316', // orange-500
                            light: '#FFB74D',
                            dark: '#E65100',
                        },
                        neutral: {
                            light: '#F8FAFC', // slate-50
                            medium: '#CBD5E1', // slate-300
                            dark: '#475569',   // slate-600
                        }
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.08)',
                        'card-hover': '0 8px 20px rgba(0, 0, 0, 0.12)',
                        'input': '0 1px 3px rgba(0,0,0,0.05) inset, 0 1px 2px rgba(0,0,0,0.03)',
                        'input-focus': '0 0 0 3px rgba(2, 132, 199, 0.2)', // primary color with opacity
                    },
                    transitionTimingFunction: {
                        'custom-ease': 'cubic-bezier(0.4, 0, 0.2, 1)',
                    },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'pulse-sm': 'pulse-sm 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'subtle-bounce': {
                            '0%, 100%': { transform: 'translateY(-3%)' },
                            '50%': { transform: 'translateY(0)' },
                        },
                        'pulse-sm': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '.7' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-light text-neutral-dark antialiased">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <a href="{% url 'product_list' %}" class="text-3xl font-extrabold text-primary hover:text-primary-dark transition-colors duration-300 ease-custom-ease">
                    üõí GnanowShop
                </a>
                <nav class="space-x-3 sm:space-x-4">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium px-2 py-1 rounded-md">Dashboard</a>
                    <a href="{% url 'view_cart' %}" class="text-gray-600 hover:text-primary transition-colors font-medium px-2 py-1 rounded-md">Cart</a>
                    <a href="{% url 'wishlist' %}" class="text-gray-600 hover:text-primary transition-colors font-medium px-2 py-1 rounded-md">Wishlist</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4 xl:w-1/5 p-6 bg-white rounded-xl shadow-card animate-fade-in">
                <form method="get" action="{% url 'product_list' %}">
                    <div class="mb-8">
                        <label for="search-input" class="block text-xl font-semibold text-neutral-dark mb-3">Search</label>
                        <div class="relative">
                            <input type="text" id="search-input" name="q" placeholder="Find your product..." value="{{ query }}"
                                   class="w-full px-4 py-3 text-gray-700 bg-neutral-light border border-neutral-medium rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all duration-300 ease-custom-ease shadow-input focus:shadow-input-focus">
                            <button type="submit" class="absolute right-0 top-0 bottom-0 px-4 text-white bg-primary hover:bg-primary-dark rounded-r-lg transition-colors duration-300 ease-custom-ease flex items-center justify-center group">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:scale-110 transition-transform" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <div>
                            <h4 class="text-lg font-semibold text-neutral-dark mb-4 border-b border-gray-200 pb-2">Category</h4>
                            <div class="space-y-2.5 max-h-60 overflow-y-auto pr-2">
                                {% for category in categories %}
                                <label class="flex items-center space-x-3 text-gray-700 hover:text-primary cursor-pointer group">
                                    <input type="checkbox" name="category" value="{{ category.slug }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-neutral-medium focus:ring-2 focus:ring-primary focus:ring-offset-1 transition duration-150 ease-in-out"
                                           {% if category.slug in selected_categories %}checked{% endif %}>
                                    <span class="group-hover:font-medium transition-all">{{ category.name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No categories.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-neutral-dark mb-4 border-b border-gray-200 pb-2">Color</h4>
                            <div class="space-y-2.5 max-h-48 overflow-y-auto pr-2">
                                {% for code, name in colors %}
                                <label class="flex items-center space-x-3 text-gray-700 hover:text-primary cursor-pointer group">
                                    <input type="checkbox" name="color" value="{{ code }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-neutral-medium focus:ring-2 focus:ring-primary focus:ring-offset-1 transition duration-150 ease-in-out"
                                           {% if code in selected_colors %}checked{% endif %}>
                                    <span class="group-hover:font-medium transition-all">{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No colors.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-neutral-dark mb-4 border-b border-gray-200 pb-2">Size</h4>
                            <div class="space-y-2.5 max-h-48 overflow-y-auto pr-2">
                                {% for code, name in sizes %}
                                <label class="flex items-center space-x-3 text-gray-700 hover:text-primary cursor-pointer group">
                                    <input type="checkbox" name="size" value="{{ code }}"
                                           class="form-checkbox h-5 w-5 text-primary rounded border-neutral-medium focus:ring-2 focus:ring-primary focus:ring-offset-1 transition duration-150 ease-in-out"
                                           {% if code in selected_sizes %}checked{% endif %}>
                                    <span class="group-hover:font-medium transition-all">{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No sizes.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-neutral-dark mb-4 border-b border-gray-200 pb-2">Price Range</h4>
                            <div class="space-y-4">
                                <div>
                                    <label for="min_price" class="block text-sm font-medium text-gray-600 mb-1">Min Price (‚Çπ)</label>
                                    <input type="number" name="min_price" id="min_price" step="1" value="{{ min_price }}" placeholder="0"
                                           class="mt-1 w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm focus:shadow-input-focus">
                                </div>
                                <div>
                                    <label for="max_price" class="block text-sm font-medium text-gray-600 mb-1">Max Price (‚Çπ)</label>
                                    <input type="number" name="max_price" id="max_price" step="1" value="{{ max_price }}" placeholder="Any"
                                           class="mt-1 w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm focus:shadow-input-focus">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-10 space-y-3">
                        <button type="submit"
                                class="w-full bg-primary text-white py-3 px-4 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg">
                            Apply Filters
                        </button>
                        <a href="{% url 'product_list' %}"
                           class="block w-full text-center bg-red-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg">
                            Clear All Filters
                        </a>
                    </div>
                </form>
            </aside>

            <main class="w-full lg:w-3/4 xl:w-4/5">
                <div class="mb-8">
                    <h2 class="text-3xl md:text-4xl font-bold text-neutral-dark">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Filtered Products
                        {% else %}
                            Discover Our Products
                        {% endif %}
                    </h2>
                    {% if products.has_other_pages %}
                    <p class="text-sm text-gray-600 mt-1.5">Showing page {{ products.number }} of {{ products.paginator.num_pages }}</p>
                    {% endif %}
                </div>

                {% if products %}
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-x-6 gap-y-8"> {/* Adjusted for potentially 3 items on larger screens */}
                    {% for product in products %}
                        {% for variant in product.variants.all %}
                        <div class="product-card group bg-white rounded-xl shadow-card hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" style="animation-delay: {{ forloop.counter0|multiply:0.06 }}s;">
                            <a href="{% url 'product_detail' product.slug %}" class="block relative overflow-hidden">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }} - {{variant.color_name}} {{variant.size}}"
                                         class="w-full h-64 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease"
                                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                                {% else %}
                                    <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available"
                                         class="w-full h-64 object-cover">
                                {% endif %}
                            </a>
                            <div class="p-5 flex flex-col flex-grow">
                                <h3 class="text-lg font-semibold text-neutral-dark mb-1.5 truncate group-hover:text-primary transition-colors" title="{{ product.name }}">
                                    <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                </h3>
                                {% if variant.color_name or variant.size %}
                                <p class="text-xs text-gray-500 mb-2.5 truncate">
                                    {{ variant.color_name|default:'' }}{% if variant.color_name and variant.size %}, {% endif %}{{ variant.size|default:'' }}
                                </p>
                                {% endif %}
                                <p class="text-2xl font-bold text-primary mb-3">‚Çπ{{ variant.price }}</p>
                                <div class="flex items-center justify-between mb-4">
                                    <p class="text-sm text-accent flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-accent-dark" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        {{ product.avg_rating|default:"4.5" }}
                                    </p>
                                    <!--
                                        IMPORTANT for Wishlist Heart:
                                        The 'active' class and 'text-red-500' (or 'fill-red-500' via CSS)
                                        must be set by the Django template based on whether the variant.id
                                        is in `wishlist_variant_ids` context variable.
                                        The JS below handles client-side toggling and server updates.
                                    -->
                                    <button class="wishlist-btn text-gray-400 hover:text-red-500 p-1.5 rounded-full transition-colors duration-200 {% if variant.id in wishlist_variant_ids %}active{% endif %}"
                                            onclick="toggleWishlist(this, '{% url 'toggle_wishlist' variant.id %}')"
                                            title="Toggle Wishlist">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                        </svg>
                                    </button>
                                </div>

                                <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
                                    {% csrf_token %}
                                    <div class="flex items-stretch rounded-md shadow-sm">
                                        <label for="quantity-{{variant.id}}" class="sr-only">Quantity</label>
                                        <input type="number" id="quantity-{{variant.id}}" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1"
                                               class="w-16 sm:w-20 px-2 py-2.5 border border-r-0 border-neutral-medium rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
                                        <button type="submit"
                                                class="flex-grow bg-primary text-white px-3 py-2.5 rounded-r-md font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-sm flex items-center justify-center space-x-2 transform hover:scale-105">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                            </svg>
                                            <span>Add</span>
                                        </button>
                                    </div>
                                </form>
                                <a href="{% url 'product_detail' product.slug %}"
                                   class="mt-3 block text-center w-full bg-secondary text-white py-2.5 px-3 rounded-md font-semibold hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-sm transform hover:scale-105">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-16 animate-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-20 w-20 text-neutral-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0zM19.5 14.25l-2.25-2.25m-10.5 0L4.5 14.25" />
                    </svg>
                    <h3 class="mt-4 text-2xl font-semibold text-neutral-dark">No Products Found</h3>
                    <p class="mt-2 text-gray-600">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Try adjusting your filters or search terms for better results.
                        {% else %}
                            It seems we're out of stock or no products match. Check back later!
                        {% endif %}
                    </p>
                    {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                    <a href="{% url 'product_list' %}"
                       class="mt-8 inline-block bg-primary text-white py-3 px-8 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg">
                        Clear Filters & Search
                    </a>
                    {% endif %}
                </div>
                {% endif %}

                {% if products.has_other_pages %}
                <nav class="mt-16 flex items-center justify-between border-t border-gray-200 pt-6 px-2 sm:px-0" aria-label="Pagination">
                    <div class="-mt-px flex w-0 flex-1">
                        {% if products.has_previous %}
                        <a href="?page={{ products.previous_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease group">
                            <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-primary transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                            </svg>
                            Previous
                        </a>
                        {% endif %}
                    </div>
                    <div class="hidden md:-mt-px md:flex">
                        {% for i in products.paginator.page_range %}
                            {% if products.number == i %}
                            <span class="inline-flex items-center border-t-2 border-primary px-4 pt-4 text-sm font-semibold text-primary" aria-current="page">{{ i }}</span>
                            {% elif i > products.number|add:'-3' and i < products.number|add:'3' %}
                            <a href="?page={{ i }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                               class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease">{{ i }}</a>
                            {% elif i == products.number|add:'-3' or i == products.number|add:'3' %}
                            <span class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500">...</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="-mt-px flex w-0 flex-1 justify-end">
                        {% if products.has_next %}
                        <a href="?page={{ products.next_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease group">
                            Next
                            <svg class="ml-3 h-5 w-5 text-gray-400 group-hover:text-primary transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </nav>
                {% endif %}

                {% if related_products %}
                <div class="mt-20">
                    <h2 class="text-3xl font-bold text-neutral-dark mb-8">You Might Also Like</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-x-6 gap-y-8">
                        {% for product in related_products %}
                            {% for variant in product.variants.all %}
                            <div class="product-card group bg-white rounded-xl shadow-card hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" style="animation-delay: {{ forloop.counter0|multiply:0.08 }}s;">
                                <a href="{% url 'product_detail' product.slug %}" class="block relative overflow-hidden">
                                    {% if variant.images.all %}
                                        <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}" class="w-full h-64 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease" onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                                    {% else %}
                                        <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available" class="w-full h-64 object-cover">
                                    {% endif %}
                                </a>
                                <div class="p-5 flex flex-col flex-grow">
                                    <h3 class="text-lg font-semibold text-neutral-dark mb-1.5 truncate group-hover:text-primary transition-colors"><a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a></h3>
                                    <p class="text-2xl font-bold text-primary mb-3">‚Çπ{{ variant.price }}</p>
                                    <div class="flex items-center justify-between mb-4">
                                        <p class="text-sm text-accent flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-accent-dark" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                            {{ product.avg_rating|default:"4.5" }}
                                        </p>
                                         <button class="wishlist-btn text-gray-400 hover:text-red-500 p-1.5 rounded-full transition-colors duration-200 {% if variant.id in wishlist_variant_ids %}active{% endif %}"
                                            onclick="toggleWishlist(this, '{% url 'toggle_wishlist' variant.id %}')"
                                            title="Toggle Wishlist">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                        </button>
                                    </div>
                                    <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
                                        {% csrf_token %}
                                        <div class="flex items-stretch rounded-md shadow-sm">
                                            <input type="number" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1" class="w-16 sm:w-20 px-2 py-2.5 border border-r-0 border-neutral-medium rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
                                            <button type="submit" class="flex-grow bg-primary text-white px-3 py-2.5 rounded-r-md font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-sm flex items-center justify-center space-x-2 transform hover:scale-105">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                                <span>Add</span>
                                            </button>
                                        </div>
                                    </form>
                                     <a href="{% url 'product_detail' product.slug %}" class="mt-3 block text-center w-full bg-secondary text-white py-2.5 px-3 rounded-md font-semibold hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-sm transform hover:scale-105">View Details</a>
                                </div>
                            </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </main>
        </div>
    </div>

    <footer class="bg-neutral-dark text-gray-300 mt-20 py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                <div>
                    <h3 class="text-2xl font-bold text-primary mb-4">GnanowShop</h3>
                    <p class="text-sm text-gray-400 leading-relaxed">Discover amazing products with Gnanow. Quality and value, delivered to your doorstep.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Shop</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="{% url 'product_list' %}" class="text-gray-400 hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Best Sellers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Sales & Offers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Customer Service</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">FAQs</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Shipping Information</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M12 2.04c-5.5 0-9.96 4.46-9.96 9.96s4.46 9.96 9.96 9.96c5.5 0 9.96-4.46 9.96-9.96S17.5 2.04 12 2.04zm4.37 7.54h-2.5V8.4c0-.52.37-.94.94-.94h1.56V5.2H14.4c-2.1 0-3.75 1.66-3.75 3.75v1.19h-2.5v2.34h2.5V18h2.97v-5.77h2.03l.47-2.34z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07A4.48 4.48 0 0016.27 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.22-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 01-1.93.07 4.28 4.28 0 004 2.98 8.521 8.521 0 01-5.33 1.84c-.34 0-.68-.02-1.01-.06A12.079 12.079 0 008.29 20c7.55 0 11.67-6.25 11.67-11.67v-.53c.8-.58 1.49-1.3 2.05-2.12z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2m-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 011.25 1.25A1.25 1.25 0 0117.25 8 1.25 1.25 0 0116 6.75a1.25 1.25 0 011.25-1.25M12 7a5 5 0 015 5 5 5 0 01-5 5 5 5 0 01-5-5 5 5 0 015-5m0 2a3 3 0 00-3 3 3 3 0 003 3 3 3 0 003-3 3 3 0 00-3-3z"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} GnanowShop. All rights reserved.</p>
                <p class="mt-1 text-gray-500">Designed with <span class="text-red-500 animate-pulse-sm">‚ô•</span> by Gnanow AI & Tailwind CSS.</p>
            </div>
        </div>
    </footer>

    <script>
        function toggleWishlist(button, url) {
            // Optimistically toggle the .active class for immediate UI feedback
            const isActiveBeforeRequest = button.classList.contains('active');
            button.classList.toggle('active');

            // The CSS rule '.wishlist-btn.active svg { fill: #ef4444; }' will handle the color change.
            // The 'animate-subtle-bounce' can also be controlled by the .active class if desired,
            // or applied/removed here.
            const svg = button.querySelector('svg');
            if (button.classList.contains('active')) {
                svg.classList.add('animate-subtle-bounce');
            } else {
                svg.classList.remove('animate-subtle-bounce');
            }

            fetch(url, {
                method: 'GET', // Or 'POST', ensure your Django view matches
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // Required for POST if CSRF is enabled
                    'X-Requested-With': 'XMLHttpRequest' // Good practice for Django to identify AJAX
                }
            })
            .then(response => {
                if (!response.ok) {
                    // If response is not OK, throw an error to be caught by .catch
                    return response.json().then(errData => { throw new Error(errData.message || 'Server error'); });
                }
                return response.json();
            })
            .then(data => {
                console.log('Wishlist toggle response:', data);
                // Server confirms the state; ensure UI matches server's final decision.
                // This is important if the optimistic update was incorrect or if there's a race condition.
                if (data.status === 'success') {
                    if (data.added) {
                        button.classList.add('active');
                        if (svg) svg.classList.add('animate-subtle-bounce');
                    } else {
                        button.classList.remove('active');
                        if (svg) svg.classList.remove('animate-subtle-bounce');
                    }
                } else {
                    // Server reported an issue, revert the optimistic update
                    button.classList.toggle('active', isActiveBeforeRequest); // Revert to original state
                    if (svg) {
                         if (button.classList.contains('active')) {
                            svg.classList.add('animate-subtle-bounce');
                        } else {
                            svg.classList.remove('animate-subtle-bounce');
                        }
                    }
                    console.error('Failed to update wishlist (server-side). Server response:', data.message || 'No specific message.');
                }
            })
            .catch(error => {
                console.error('Error toggling wishlist (network/client-side):', error);
                // Network error or other client-side issue, revert the optimistic update
                button.classList.toggle('active', isActiveBeforeRequest); // Revert to original state
                 if (svg) {
                    if (button.classList.contains('active')) {
                        svg.classList.add('animate-subtle-bounce');
                    } else {
                        svg.classList.remove('animate-subtle-bounce');
                    }
                }
                // Optionally, notify the user via a non-blocking message
            });
        }

        const toTopButton = document.createElement('button');
        toTopButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" /></svg>`;
        toTopButton.className = 'fixed bottom-8 right-8 bg-primary text-white p-3.5 rounded-full shadow-xl hover:bg-primary-dark transition-all duration-300 ease-custom-ease opacity-0 transform translate-y-5 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2';
        toTopButton.style.zIndex = '1000';
        toTopButton.style.visibility = 'hidden';
        toTopButton.setAttribute('aria-label', 'Scroll to top');

        document.body.appendChild(toTopButton);

        window.addEventListener('scroll', () => {
            if (window.scrollY > 400) {
                toTopButton.style.opacity = '1';
                toTopButton.style.transform = 'translateY(0)';
                toTopButton.style.visibility = 'visible';
            } else {
                toTopButton.style.opacity = '0';
                toTopButton.style.transform = 'translateY(1.25rem)'; // 5 * 0.25rem
                setTimeout(() => {
                    if (window.scrollY <= 400) toTopButton.style.visibility = 'hidden';
                }, 300); // Match transition duration
            }
        });

        toTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

    </script>

</body>
</html> {% endcomment %}
{% comment %} 
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products - Shop</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        .container { display: flex; }
        .sidebar { width: 20%; padding: 10px; border-right: 1px solid #ccc; }
        .main-content { width: 80%; padding: 10px; }
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .product-card { border: 1px solid #ddd; padding: 10px; border-radius: 8px; text-align: center; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; }
        .filters h4 { margin-top: 20px; }
        .wishlist-btn { font-size: 20px; cursor: pointer; color: #ccc; }
        .wishlist-btn.active { color: red; }
        .search-bar { margin-bottom: 20px; }
    </style>
</head>
<body>
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
            <h1>üõí ShopLogo</h1>
            <nav>
                <a href="{% url 'dashboard' %}">Dashboard</a> |
                <a href="{% url 'view_cart' %}">Cart</a> |
                <a href="{% url 'wishlist' %}">Wishlist</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="sidebar filters">
            <form method="get">
                <div class="search-bar">
                    <input type="text" name="q" placeholder="Search products..." value="{{ query }}">
                    <button type="submit">Search</button>
                </div>

                <h4>Category</h4>
                {% for category in categories %}
                    <label>
                        <input type="checkbox" name="category" value="{{ category.slug }}" {% if category.slug in selected_categories %}checked{% endif %}>
                        {{ category.name }}
                    </label><br>
                {% endfor %}

                <h4>Color</h4>
                {% for code, name in colors %}
                    <label>
                        <input type="checkbox" name="color" value="{{ code }}" {% if code in selected_colors %}checked{% endif %}>
                        {{ name }}
                    </label><br>
                {% endfor %}

                <h4>Size</h4>
                {% for code, name in sizes %}
                    <label>
                        <input type="checkbox" name="size" value="{{ code }}" {% if code in selected_sizes %}checked{% endif %}>
                        {{ name }}
                    </label><br>
                {% endfor %}

                <h4>Price</h4>
                Min: <input type="number" name="min_price" step="0.01" value="{{ min_price }}"><br>
                Max: <input type="number" name="max_price" step="0.01" value="{{ max_price }}"><br>

                <button type="submit">Apply Filters</button>
                <a href="{% url 'product_list' %}" style="display: inline-block; padding: 8px 16px; background-color: #f44336; color: white; text-decoration: none; border-radius: 4px; margin-left: 10px;">Clear All Filters</a>
            </form>
        </div>

        <div class="main-content">
            <h2>All Products</h2>
            <div class="product-grid">
                {% for product in products %}
                    {% for variant in product.variants.all %}
                        <div class="product-card">
                            {% if variant.images.all %}
                                <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <img src="{% static 'images/no-image.jpg' %}" alt="No image">
                            {% endif %}
                            <h3>{{ product.name }}</h3>
                            <p>‚Çπ{{ variant.price }}</p>
                            <p>‚≠ê {{ product.avg_rating|default:"4.5" }}</p>
                            <span class="wishlist-btn {% if variant.id in wishlist_variant_ids %}active{% endif %}" onclick="location.href='{% url 'toggle_wishlist' variant.id %}'">‚ô•</span>
                            <form action="{% url 'add_to_cart' variant.id %}" method="post">
                                {% csrf_token %}
                                <input type="number" name="quantity" min="1" max="{{ variant.stock }}" value="1">
                                <button type="submit">Add to Cart</button>
                            </form>
                            <a href="{% url 'product_detail' product.slug %}"><button>View Details</button></a>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
    </div>
</body>
</html> {% endcomment %}



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Gnanow Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #F8FAFC; /* Tailwind slate-50 / neutral.light */
        }
        .custom-alert {
      position: fixed;
      top: 20px;
      right: -400px;
      background-color: #f0f0f0;
      color: #333;
      padding: 16px 50px 16px 20px;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      font-size: 16px;
      z-index: 1000;
      transition: right 0.6s ease, opacity 0.5s ease;
      opacity: 0;
      min-width: 250px;
      max-width: 300px;
    }

    .custom-alert.show {
      right: 20px;
      opacity: 1;
    }

    .custom-alert .close-btn {
      position: absolute;
      top: 50%;
      right: 15px;
      transform: translateY(-50%);
      color: red;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
    }

    .custom-alert .close-btn:hover {
      color: darkred;
    } 
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #edf2f7; /* Tailwind gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0aec0; /* Tailwind gray-500 */
            border-radius: 10px;
            border: 2px solid #edf2f7; /* Tailwind gray-200 - creates padding */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* Tailwind gray-600 */
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wishlist-btn svg {
            transition: transform 0.25s ease-in-out, fill 0.25s ease-in-out;
        }
        .wishlist-btn:hover svg {
            transform: scale(1.15);
        }
        /* This CSS rule is crucial for the heart to be filled red when .active class is present */
        .wishlist-btn.active svg {
            fill: #ef4444; /* Red-500 for active wishlist */
            stroke: #ef4444; /* Ensure stroke also changes for consistency */
        }

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', "Noto Sans", 'sans-serif', "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"],
                    },
                    colors: {
                        // Gnanow Brand Colors
                        primary: {
                            DEFAULT: '#0284C7', // sky-600
                            light: '#03A9F4', // A lighter shade for hover or accents
                            dark: '#01579B',  // A darker shade for active states
                        },
                        secondary: {
                            DEFAULT: '#14B8A6', // teal-500
                            light: '#4DB6AC',
                            dark: '#00796B',
                        },
                        accent: {
                            DEFAULT: '#F97316', // orange-500
                            light: '#FFB74D',
                            dark: '#E65100',
                        },
                        neutral: {
                            light: '#F8FAFC', // slate-50
                            DEFAULT: '#F1F5F9', // slate-100 (used for main product bg)
                            medium: '#CBD5E1', // slate-300
                            dark: '#475569',   // slate-600
                            darker: '#1E293B', // slate-800
                        }
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.07)',
                        'card-hover': '0 10px 25px rgba(0, 0, 0, 0.1)',
                        'input': '0 1px 3px rgba(0,0,0,0.05) inset, 0 1px 2px rgba(0,0,0,0.03)',
                        'input-focus': '0 0 0 3px rgba(2, 132, 199, 0.25)', // primary color with opacity
                        'header': '0 2px 8px rgba(0,0,0,0.06)',
                    },
                    transitionTimingFunction: {
                        'custom-ease': 'cubic-bezier(0.4, 0, 0.2, 1)',
                    },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'pulse-sm': 'pulse-sm 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'subtle-bounce': {
                            '0%, 100%': { transform: 'translateY(-3%)' },
                            '50%': { transform: 'translateY(0)' },
                        },
                        'pulse-sm': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '.7' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-light text-neutral-dark antialiased">
     {% if status == "1" or status == "0" %}
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const alert = document.createElement('div');
        alert.className = 'custom-alert';

        {% if status == "1" %}
          alert.innerHTML = `Item added to wishlist! <span class="close-btn" onclick="this.parentElement.remove()">√ó</span>`;
          alert.style.backgroundColor = '#d4edda';
          alert.style.color = 'green';
        {% elif status == "0" %}
          alert.innerHTML = `Item removed from wishlist. <span class="close-btn" onclick="this.parentElement.remove()">√ó</span>`;
          alert.style.backgroundColor = '#f8d7da';
          alert.style.color = 'red';
                {% endif %}

        document.body.appendChild(alert);

        setTimeout(() => {
          alert.classList.add('show');
        }, 100);

        setTimeout(() => {
          alert.classList.remove('show');
          setTimeout(() => alert.remove(), 500);
        }, 30000);
      });
    </script>
  {% endif %}


    <header class="bg-white shadow-header sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                <a href="{% url 'product_list' %}" class="text-2xl sm:text-3xl font-extrabold text-primary hover:text-primary-dark transition-colors duration-300 ease-custom-ease">
                    üõí GnanowShop
                </a>
                <div class="flex items-center space-x-3 sm:space-x-4">
                    <a href="{% url 'view_cart' %}" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Cart">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </a>
                    <a href="{% url 'wishlist' %}" class="text-neutral-dark hover:text-red-500 p-2 rounded-full transition-colors" title="Wishlist">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </a>
                    <a href="#" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Profile">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-xl sm:text-2xl font-semibold text-neutral-darker mb-3 sm:mb-0">GNANOW Product List</h1>
                <nav class="flex space-x-4 sm:space-x-6 text-sm sm:text-base">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Home</a>
                    <a href="{% url 'product_list' %}" class="text-primary font-semibold">Products</a> 
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors font-medium">Categories</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 mt-6 mb-8">
        <form method="get" action="{% url 'product_list' %}" class="relative">
            <input type="text" name="q" placeholder="Search for products, brands and more..." value="{{ query }}"
                   class="w-full px-6 py-4 text-base text-gray-800 bg-white border-2 border-neutral-medium rounded-xl focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all duration-300 ease-custom-ease shadow-md focus:shadow-lg placeholder-gray-500">
            <button type="submit" class="absolute right-2 top-1/2 transform -translate-y-1/2 p-3 text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors duration-300 ease-custom-ease flex items-center justify-center group">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 group-hover:scale-110 transition-transform" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
            </button>
        </form>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4 xl:w-1/5 p-6 bg-white rounded-xl shadow-card animate-fade-in self-start"> 
                <form method="get" action="{% url 'product_list' %}">
                    <div class="mb-8 space-y-3">
                        <button type="submit"
                                class="w-full bg-primary text-white py-2.5 px-4 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-1 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg">
                            Apply Filters
                        </button>
                        <a href="{% url 'product_list' %}"
                           class="block w-full text-center bg-gray-200 text-neutral-dark hover:bg-gray-300 py-2.5 px-4 rounded-lg font-semibold focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 focus:ring-offset-1 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-sm hover:shadow-md">
                            Clear All Filters
                        </a>
                    </div>

                    <div class="space-y-8">
                        <div>
                            <h4 class="text-lg font-semibold text-neutral-darker mb-3 border-b border-gray-200 pb-2">Category</h4>
                            <div class="space-y-2 max-h-60 overflow-y-auto pr-2">
                                {% for category in categories %}
                                <label class="flex items-center space-x-3 text-gray-700 hover:text-primary cursor-pointer group">
                                    <input type="checkbox" name="category" value="{{ category.slug }}"
                                           class="form-checkbox h-4 w-4 text-primary rounded border-neutral-medium focus:ring-2 focus:ring-primary focus:ring-offset-1 transition duration-150 ease-in-out"
                                           {% if category.slug in selected_categories %}checked{% endif %}>
                                    <span class="text-sm group-hover:font-medium transition-all">{{ category.name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No categories.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-neutral-darker mb-3 border-b border-gray-200 pb-2">Color</h4>
                            <div class="space-y-2 max-h-48 overflow-y-auto pr-2">
                                {% for code, name in colors %}
                                <label class="flex items-center space-x-3 text-gray-700 hover:text-primary cursor-pointer group">
                                    <input type="checkbox" name="color" value="{{ code }}"
                                           class="form-checkbox h-4 w-4 text-primary rounded border-neutral-medium focus:ring-2 focus:ring-primary focus:ring-offset-1 transition duration-150 ease-in-out"
                                           {% if code in selected_colors %}checked{% endif %}>
                                    <span class="text-sm group-hover:font-medium transition-all">{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No colors.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-neutral-darker mb-3 border-b border-gray-200 pb-2">Size</h4>
                            <div class="space-y-2 max-h-48 overflow-y-auto pr-2">
                                {% for code, name in sizes %}
                                <label class="flex items-center space-x-3 text-gray-700 hover:text-primary cursor-pointer group">
                                    <input type="checkbox" name="size" value="{{ code }}"
                                           class="form-checkbox h-4 w-4 text-primary rounded border-neutral-medium focus:ring-2 focus:ring-primary focus:ring-offset-1 transition duration-150 ease-in-out"
                                           {% if code in selected_sizes %}checked{% endif %}>
                                    <span class="text-sm group-hover:font-medium transition-all">{{ name }}</span>
                                </label>
                                {% empty %}
                                <p class="text-sm text-gray-500">No sizes.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold text-neutral-darker mb-3 border-b border-gray-200 pb-2">Price Range</h4>
                            <div class="space-y-3">
                                <div>
                                    <label for="min_price" class="block text-xs font-medium text-gray-600 mb-1">Min Price (‚Çπ)</label>
                                    <input type="number" name="min_price" id="min_price" step="1" value="{{ min_price }}" placeholder="0"
                                           class="w-full px-3 py-2 text-sm text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm focus:shadow-input-focus">
                                </div>
                                <div>
                                    <label for="max_price" class="block text-xs font-medium text-gray-600 mb-1">Max Price (‚Çπ)</label>
                                    <input type="number" name="max_price" id="max_price" step="1" value="{{ max_price }}" placeholder="Any"
                                           class="w-full px-3 py-2 text-sm text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm focus:shadow-input-focus">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </aside>

            {% comment %} <main class="w-full lg:w-3/4 xl:w-4/5 bg-white p-6 sm:p-8 rounded-xl shadow-card">
                {% if products.has_other_pages and not query and not selected_categories and not selected_colors and not selected_sizes and not min_price and not max_price %}
                    <p class="text-sm text-gray-600 mb-6 -mt-2">Showing page {{ products.number }} of {{ products.paginator.num_pages }}</p>
                {% endif %}

                {% if products %}
                <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
                    {% for product in products %}
                        {% for variant in product.variants.all %}
                        <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" >
                            <a href="{% url 'product_detail' product.slug %}" class="block relative overflow-hidden rounded-t-xl">
                                {% if variant.images.all %}
                                    <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }} - {{variant.color_name}} {{variant.size}}"
                                         class="w-full h-56 sm:h-64 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease"
                                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                                {% else %}
                                    <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available"
                                         class="w-full h-56 sm:h-64 object-cover">
                                {% endif %}
                            </a>
                            <div class="p-4 sm:p-5 flex flex-col flex-grow">
                                <h3 class="text-base sm:text-lg font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors" title="{{ product.name }}">
                                    <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                </h3>
                                 <!-- ‚ù§Ô∏è Place the button below image or name -->
            <form method="post" action="{% url 'toggle_wishlist_p_list' variant.id %}">
                {% csrf_token %}
                <button type="submit" class="wishlist-btn text-xl focus:outline-none {% if variant.id in wishlist_variant_ids %}text-red-500{% else %}text-gray-300{% endif %}">
                    {% if variant.id in wishlist_variant_ids %}
                        ‚ô•
                    {% else %}
                        ‚ô°
                    {% endif %}
                </button>
            </form>
                                {% if variant.color_name or variant.size %}
                                <p class="text-xs text-gray-500 mb-2 truncate">
                                    {{ variant.color_name|default:'' }}{% if variant.color_name and variant.size %}, {% endif %}{{ variant.size|default:'' }}
                                </p>
                                {% endif %}
                                <p class="text-xl sm:text-2xl font-bold text-primary mb-2.5">‚Çπ{{ variant.price }}</p>
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm text-accent flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 text-accent-dark" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        {{ product.avg_rating|default:"4.5" }}
                                    </p>
                           

                                </div>

                                <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
                                    {% csrf_token %}
                                    <div class="flex items-stretch rounded-md shadow-sm">
                                        <label for="quantity-{{variant.id}}" class="sr-only">Quantity</label>
                                        <input type="number" id="quantity-{{variant.id}}" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1"
                                               class="w-14 sm:w-16 px-2 py-2 border border-r-0 border-neutral-medium rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
                                        <button type="submit"
                                                class="flex-grow bg-primary text-white px-2.5 sm:px-3 py-2 rounded-r-md font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm flex items-center justify-center space-x-1.5 transform hover:scale-105">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                            </svg>
                                            <span>Add</span>
                                        </button>
                                    </div>
                                </form>
                                <a href="{% url 'product_detail' product.slug %}"
                                   class="mt-2.5 block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm transform hover:scale-105">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-16 animate-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-20 w-20 text-neutral-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0zM19.5 14.25l-2.25-2.25m-10.5 0L4.5 14.25" />
                    </svg>
                    <h3 class="mt-4 text-2xl font-semibold text-neutral-darker">No Products Found</h3>
                    <p class="mt-2 text-gray-600">
                        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                            Try adjusting your filters or search terms for better results.
                        {% else %}
                            It seems we're out of stock or no products match. Check back later!
                        {% endif %}
                    </p>
                    {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                    <a href="{% url 'product_list' %}"
                       class="mt-8 inline-block bg-primary text-white py-3 px-8 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg">
                        Clear Filters & Search
                    </a>
                    {% endif %}
                </div>
                {% endif %}

                {% if products.has_other_pages %}
                <nav class="mt-16 flex items-center justify-between border-t border-gray-200 pt-6 px-2 sm:px-0" aria-label="Pagination">
                    <div class="-mt-px flex w-0 flex-1">
                        {% if products.has_previous %}
                        <a href="?page={{ products.previous_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease group">
                            <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-primary transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                            </svg>
                            Previous
                        </a>
                        {% endif %}
                    </div>
                    <div class="hidden md:-mt-px md:flex">
                        {% for i in products.paginator.page_range %}
                            {% if products.number == i %}
                            <span class="inline-flex items-center border-t-2 border-primary px-4 pt-4 text-sm font-semibold text-primary" aria-current="page">{{ i }}</span>
                            {% elif i > products.number|add:'-3' and i < products.number|add:'3' %}
                            <a href="?page={{ i }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                               class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease">{{ i }}</a>
                            {% elif i == products.number|add:'-3' or i == products.number|add:'3' %}
                            <span class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500">...</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="-mt-px flex w-0 flex-1 justify-end">
                        {% if products.has_next %}
                        <a href="?page={{ products.next_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                           class="inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease group">
                            Next
                            <svg class="ml-3 h-5 w-5 text-gray-400 group-hover:text-primary transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </nav>
                {% endif %}

                {% if related_products %}
                <div class="mt-20">
                    <h2 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-8">You Might Also Like</h2>
                    <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
                        {% for product in related_products %}
                            {% for variant in product.variants.all %}
                            <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" >
                                <a href="{% url 'product_detail' product.slug %}" class="block relative overflow-hidden rounded-t-xl">
                                    {% if variant.images.all %}
                                        <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}" class="w-full h-56 sm:h-64 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease" onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                                    {% else %}
                                        <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available" class="w-full h-56 sm:h-64 object-cover">
                                    {% endif %}
                                </a>
                                <div class="p-4 sm:p-5 flex flex-col flex-grow">
                                    <h3 class="text-base sm:text-lg font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors"><a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a></h3>
                                    <p class="text-xl sm:text-2xl font-bold text-primary mb-2.5">‚Çπ{{ variant.price }}</p>
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="text-sm text-accent flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 text-accent-dark" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                            {{ product.avg_rating|default:"4.5" }}
                                        </p>
                            
 <form method="post" action="{% url 'toggle_wishlist_p_list' variant.id %}" class="wishlist-btn text-gray-400 hover:text-red-500 p-1 rounded-full transition-colors duration-200">
    {% csrf_token %}
    <button type="submit">
        <i style="font-size: 27px;"
   class="{% if variant.id in wishlist_variant_ids %}
             fas fa-heart text-brand-yellow
           {% else %}
             far fa-heart text-white
           {% endif %}">
            
</i>
</button>
</form>
                                    
                                    <form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
                                        {% csrf_token %}
                                        <div class="flex items-stretch rounded-md shadow-sm">
                                            <input type="number" name="quantity" min="1" max="{{ variant.stock|default:99 }}" value="1" class="w-14 sm:w-16 px-2 py-2 border border-r-0 border-neutral-medium rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
                                            <button type="submit" class="flex-grow bg-primary text-white px-2.5 sm:px-3 py-2 rounded-r-md font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm flex items-center justify-center space-x-1.5 transform hover:scale-105">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                                <span>Add</span>
                                            </button>
                                        </div>
                                    </form>
                                     <a href="{% url 'product_detail' product.slug %}" class="mt-2.5 block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm transform hover:scale-105">View Details</a>
                                </div>
                            </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </main> {% endcomment %}


            <main class="w-full lg:w-3/4 xl:w-4/5 bg-white p-6 sm:p-8 rounded-xl shadow-card">
    {% if products.has_other_pages and not query and not selected_categories and not selected_colors and not selected_sizes and not min_price and not max_price %}
        <p class="text-sm text-gray-600 mb-6 -mt-2">Showing page {{ products.number }} of {{ products.paginator.num_pages }}</p>
    {% endif %}

    {% if products %}
    <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
        {% for product in products %}
            {% for variant in product.variants.all %}
            <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" >
                <a href="{% url 'product_detail' product.slug %}" class="block relative overflow-hidden rounded-t-xl">
                    {% if variant.images.all %}
                        <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }} - {{variant.color_name}} {{variant.size}}"
                             class="w-full h-56 sm:h-64 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease"
                             onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                    {% else %}
                        <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available"
                             class="w-full h-56 sm:h-64 object-cover">
                    {% endif %}
                           {% if variant.stock == 0 %}
    <span class="absolute bottom-2 left-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">Out of Stock</span>
{% endif %}

                    <form method="post" action="{% url 'toggle_wishlist_p_list' variant.id %}" class="absolute top-2 right-2 z-10">
                        {% csrf_token %}
                        <button type="submit" class="wishlist-btn text-xl focus:outline-none {% if variant.id in wishlist_variant_ids %}text-red-500{% else %}text-gray-300{% endif %} bg-white rounded-full p-2 shadow-md">
                            {% if variant.id in wishlist_variant_ids %}
                                ‚ô•
                            {% else %}
                                ‚ô°
                            {% endif %}
                        </button>
                    </form>

                </a>
            
                <div class="p-4 sm:p-5 flex flex-col flex-grow">
                    <h3 class="text-base sm:text-lg font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors" title="{{ product.name }}">
                        <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                    </h3>
                    {% if variant.color_name or variant.size %}
                    <p class="text-xs text-gray-500 mb-2 truncate">
                        {{ variant.color_name|default:'' }}{% if variant.color_name and variant.size %}, {% endif %}{{ variant.size|default:'' }}
                    </p>
                    {% endif %}
                    <p class="text-xl sm:text-2xl font-bold text-primary mb-2.5">‚Çπ{{ variant.price }}</p>
                    <div class="flex items-center justify-between mb-3">
                        <p class="text-sm text-accent flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 text-accent-dark" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                            {{ product.avg_rating|default:"4.5" }}
                        </p>
                    </div>
                    {% if variant.stock > 0 %}
<form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
    {% csrf_token %}
    <div class="flex items-stretch rounded-md shadow-sm">
        <label for="quantity-{{variant.id}}" class="sr-only">Quantity</label>
        <input type="number" id="quantity-{{variant.id}}" name="quantity" min="1" max="{{ variant.stock }}" value="1"
               class="w-14 sm:w-16 px-2 py-2 border border-r-0 border-neutral-medium rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
        <button type="submit"
                class="flex-grow bg-primary text-white px-2.5 sm:px-3 py-2 rounded-r-md font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm flex items-center justify-center space-x-1.5 transform hover:scale-105">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>Add</span>
        </button>
    </div>
</form>
{% else %}
<div class="mt-auto">
    <span class="block w-full text-center py-2 px-3 bg-gray-300 text-gray-700 rounded-md font-semibold cursor-not-allowed">
        Out of Stock
    </span>
</div>
{% endif %}

                    <a href="{% url 'product_detail' product.slug %}"
                       class="mt-2.5 block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm transform hover:scale-105">
                        View Details
                    </a>
                </div>
            </div>
            {% endfor %}
            
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-16 animate-fade-in">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-20 w-20 text-neutral-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0zM19.5 14.25l-2.25-2.25m-10.5 0L4.5 14.25" />
        </svg>
        <h3 class="mt-4 text-2xl font-semibold text-neutral-darker">No Products Found</h3>
        <p class="mt-2 text-gray-600">
            {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
                Try adjusting your filters or search terms for better results.
            {% else %}
                It seems we're out of stock or no products match. Check back later!
            {% endif %}
        </p>
        {% if query or selected_categories or selected_colors or selected_sizes or min_price or max_price %}
        <a href="{% url 'product_list' %}"
           class="mt-8 inline-block bg-primary text-white py-3 px-8 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg">
            Clear Filters & Search
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% if products.has_other_pages %}
    <nav class="mt-16 flex items-center justify-between border-t border-gray-200 pt-6 px-2 sm:px-0" aria-label="Pagination">
        <div class="-mt-px flex w-0 flex-1">
            {% if products.has_previous %}
            <a href="?page={{ products.previous_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
               class="inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease group">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-primary transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                </svg>
                Previous
            </a>
            {% endif %}
        </div>
        <div class="hidden md:-mt-px md:flex">
            {% for i in products.paginator.page_range %}
                {% if products.number == i %}
                <span class="inline-flex items-center border-t-2 border-primary px-4 pt-4 text-sm font-semibold text-primary" aria-current="page">{{ i }}</span>
                {% elif i > products.number|add:'-3' and i < products.number|add:'3' %}
                <a href="?page={{ i }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
                   class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease">{{ i }}</a>
                {% elif i == products.number|add:'-3' or i == products.number|add:'3' %}
                <span class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500">...</span>
                {% endif %}
            {% endfor %}
        </div>
        <div class="-mt-px flex w-0 flex-1 justify-end">
            {% if products.has_next %}
            <a href="?page={{ products.next_page_number }}{% for key, value_list in request.GET.lists %}{% if key != 'page' %}{% for value in value_list %}&{{ key }}={{ value }}{% endfor %}{% endif %}{% endfor %}"
               class="inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-primary transition-colors duration-200 ease-custom-ease group">
                Next
                <svg class="ml-3 h-5 w-5 text-gray-400 group-hover:text-primary transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                </svg>
            </a>
            {% endif %}
        </div>
    </nav>
    {% endif %}

    {% if related_products %}
    <div class="mt-20">
        <h2 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-8">You Might Also Like</h2>
        <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
            {% for product in related_products %}
                {% for variant in product.variants.all %}
                <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" >
                    <a href="{% url 'product_detail' product.slug %}" class="block relative overflow-hidden rounded-t-xl">
                        {% if variant.images.all %}
                            <img src="{{ variant.images.first.image.url }}" alt="{{ product.name }}" class="w-full h-56 sm:h-64 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease" onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                        {% else %}
                            <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available" class="w-full h-56 sm:h-64 object-cover">
                        {% endif %}
                        <form method="post" action="{% url 'toggle_wishlist_p_list' variant.id %}" class="absolute top-2 right-2 z-10">
                            {% csrf_token %}
                            <button type="submit" class="wishlist-btn text-xl focus:outline-none {% if variant.id in wishlist_variant_ids %}text-red-500{% else %}text-gray-300{% endif %} bg-white rounded-full p-2 shadow-md">
                                {% if variant.id in wishlist_variant_ids %}
                                    ‚ô•
                                {% else %}
                                    ‚ô°
                                {% endif %}
                            </button>
                        </form>
                    </a>
                    <div class="p-4 sm:p-5 flex flex-col flex-grow">
                        <h3 class="text-base sm:text-lg font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors"><a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a></h3>
                        <p class="text-xl sm:text-2xl font-bold text-primary mb-2.5">‚Çπ{{ variant.price }}</p>
                        <div class="flex items-center justify-between mb-3">
                            <p class="text-sm text-accent flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 text-accent-dark" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                {{ product.avg_rating|default:"4.5" }}
                            </p>
                        </div>
                        {% if variant.stock > 0 %}
<form action="{% url 'add_to_cart' variant.id %}" method="post" class="mt-auto">
    {% csrf_token %}
    <div class="flex items-stretch rounded-md shadow-sm">
        <label for="quantity-{{variant.id}}" class="sr-only">Quantity</label>
        <input type="number" id="quantity-{{variant.id}}" name="quantity" min="1" max="{{ variant.stock }}" value="1"
               class="w-14 sm:w-16 px-2 py-2 border border-r-0 border-neutral-medium rounded-l-md text-center focus:ring-1 focus:ring-primary focus:border-primary text-sm appearance-none [-moz-appearance:textfield]">
        <button type="submit"
                class="flex-grow bg-primary text-white px-2.5 sm:px-3 py-2 rounded-r-md font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm flex items-center justify-center space-x-1.5 transform hover:scale-105">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>Add</span>
        </button>
    </div>
</form>
{% else %}
<div class="mt-auto">
    <span class="block w-full text-center py-2 px-3 bg-gray-300 text-gray-700 rounded-md font-semibold cursor-not-allowed">
        Out of Stock
    </span>
</div>
{% endif %}

                         <a href="{% url 'product_detail' product.slug %}" class="mt-2.5 block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-60 focus:ring-offset-1 transition-all duration-200 ease-custom-ease text-xs sm:text-sm transform hover:scale-105">View Details</a>
                    </div>
                </div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
</main>
        </div>
    </div>

    <footer class="bg-neutral-darker text-gray-300 mt-20 py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                <div>
                    <h3 class="text-2xl font-bold text-primary mb-4">GnanowShop</h3>
                    <p class="text-sm text-gray-400 leading-relaxed">Discover amazing products with Gnanow. Quality and value, delivered to your doorstep.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Shop</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="{% url 'product_list' %}" class="text-gray-400 hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Best Sellers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Sales & Offers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Customer Service</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">FAQs</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Shipping Information</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M12 2.04c-5.5 0-9.96 4.46-9.96 9.96s4.46 9.96 9.96 9.96c5.5 0 9.96-4.46 9.96-9.96S17.5 2.04 12 2.04zm4.37 7.54h-2.5V8.4c0-.52.37-.94.94-.94h1.56V5.2H14.4c-2.1 0-3.75 1.66-3.75 3.75v1.19h-2.5v2.34h2.5V18h2.97v-5.77h2.03l.47-2.34z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07A4.48 4.48 0 0016.27 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.22-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 01-1.93.07 4.28 4.28 0 004 2.98 8.521 8.521 0 01-5.33 1.84c-.34 0-.68-.02-1.01-.06A12.079 12.079 0 008.29 20c7.55 0 11.67-6.25 11.67-11.67v-.53c.8-.58 1.49-1.3 2.05-2.12z"></path></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2m-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 011.25 1.25A1.25 1.25 0 0117.25 8 1.25 1.25 0 0116 6.75a1.25 1.25 0 011.25-1.25M12 7a5 5 0 015 5 5 5 0 01-5 5 5 5 0 01-5-5 5 5 0 015-5m0 2a3 3 0 00-3 3 3 3 0 003 3 3 3 0 003-3 3 3 0 00-3-3z"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} GnanowShop. All rights reserved.</p>
                <p class="mt-1 text-gray-500">Designed with <span class="text-red-500 animate-pulse-sm">‚ô•</span> by Gnanow AI & Tailwind CSS.</p>
            </div>
        </div>
    </footer>


</body>
</html>
