{% comment %} {% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">

  <!-- Navbar / Logo -->
  {% include 'partials/navbar.html' %}

  <!-- Product Details -->
  <div class="row mb-5">
    <div class="col-md-6">
      <!-- Main Image -->
      {% if images %}
        <img src="{{ images.0.image.url }}" class="img-fluid rounded" alt="{{ product.name }}">
      {% else %}
        <img src="{% static 'images/placeholder.png' %}" class="img-fluid" alt="No image">
      {% endif %}
    </div>

    <div class="col-md-6">
      <h2>{{ product.name }}</h2>
      <p>{{ product.description }}</p>

      {% if first_variant %}
        <h4>From ₹{{ first_variant.price }}</h4>
      {% endif %}

      <!-- Variant Options -->
      <form method="post" action="{% url 'add_to_cart' %}">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ product.id }}">

        <div class="form-group">
          <label>Color:</label>
          <select name="color" class="form-control">
            {% for variant in variants %}
              <option value="{{ variant.color }}">{{ variant.color }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label>Size:</label>
          <select name="size" class="form-control">
            {% for variant in variants %}
              <option value="{{ variant.size }}">{{ variant.size }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label>Quantity:</label>
          <input type="number" name="quantity" value="1" min="1" class="form-control" />
        </div>

        <button type="submit" class="btn btn-primary">Add to Cart</button>
        <button type="submit" formaction="{% url 'add_to_wishlist' %}" class="btn btn-outline-danger">
          <i class="fas fa-heart"></i> Wishlist
        </button>
      </form>
    </div>
  </div>

  <!-- Related Products -->
  <h3 class="mt-5 mb-3">Related Products</h3>
  <div class="row">
    {% for related in related_products %}
      <div class="col-md-3 mb-4">
        <div class="card h-100">
          {% with image=related.variants.first.images.first %}
            {% if image %}
              <img src="{{ image.image.url }}" class="card-img-top" alt="{{ related.name }}">
            {% else %}
              <img src="{% static 'images/placeholder.png' %}" class="card-img-top" alt="No image">
            {% endif %}
          {% endwith %}
          <div class="card-body">
            <h5 class="card-title">{{ related.name }}</h5>
            <p>From ₹{{ related.variants.first.price }}</p>
            <div class="d-flex justify-content-between">
              <form method="post" action="{% url 'add_to_cart' %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ related.id }}">
                <input type="hidden" name="quantity" value="1">
                <button class="btn btn-sm btn-success">Add to Cart</button>
              </form>
              <a href="{% url 'product_detail' related.slug %}" class="btn btn-sm btn-info">View</a>
              <form method="post" action="{% url 'add_to_wishlist' %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ related.id }}">
                <button class="btn btn-sm btn-outline-danger"><i class="fas fa-heart"></i></button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %} {% endcomment %}
{% comment %} 

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }} | Product Details</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .navbar {
            margin-bottom: 30px;
        }

        .product-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
        }

        .product-card {
            height: 100%;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
        }

        .card-img-top {
            max-height: 180px;
            object-fit: contain;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .related-heading {
            margin-top: 50px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand font-weight-bold" href="/">YourLogo</a>
</nav>

<div class="container">
    <!-- Product Details -->
    <div class="row">
        <div class="col-md-6">
            {% if images %}
                <img src="{{ images.0.image.url }}" class="product-image" alt="{{ product.name }}">
            {% else %}
                <img src="https://via.placeholder.com/400" class="product-image" alt="No image">
            {% endif %}
        </div>
        <div class="col-md-6">
            <h2>{{ product.name }}</h2>
            <p>{{ product.description }}</p>

            {% if first_variant %}
                <h4>Price: ₹{{ first_variant.price }}</h4>
            {% endif %}

            <form method="post" action="{% url 'add_to_cart' first_variant.id %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ product.id }}">

                <div class="form-group">
                    <label for="color">Color:</label>
                    <select name="color" id="color" class="form-control">
                        {% for variant in variants %}
                            <option value="{{ variant.color }}">{{ variant.color }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="size">Size:</label>
                    <select name="size" id="size" class="form-control">
                        {% for variant in variants %}
                            <option value="{{ variant.size }}">{{ variant.size }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>Quantity:</label>
                    <input type="number" name="quantity" class="form-control" value="1" min="1">
                </div>
  {% if first_variant %}
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Add to Cart</button>
                    <button type="submit" formaction="{% url 'toggle_wishlist' first_variant.id %}" class="btn btn-outline-danger">
                        ❤️ Wishlist
                    </button>
                </div>
                  {% endif %}
            </form>
        </div>
    </div>

    <!-- Related Products -->
    <h3 class="related-heading">Related Products</h3>
    <div class="row">
        {% for related in related_products %}
        <div class="col-md-3 mb-4">
            <div class="product-card">
                {% with image=related.variants.first.images.first %}
                    {% if image %}
                        <img src="{{ image.image.url }}" class="card-img-top" alt="{{ related.name }}">
                    {% else %}
                        <img src="https://via.placeholder.com/150" class="card-img-top" alt="No image">
                    {% endif %}
                {% endwith %}
                <h5 class="product-title mt-2">{{ related.name }}</h5>
                <p>price ₹{{ related.variants.first.price }}</p>

                <div class="btn-group">
                    <form method="post" action="{% url 'add_to_cart' related.variants.first.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ related.id }}">
                        <input type="hidden" name="quantity" value="1">
                        <button class="btn btn-sm btn-primary">Cart</button>
                    </form>

                    <a href="{% url 'product_detail' related.slug %}" class="btn btn-sm btn-info">View</a>

                    <form method="post" action="{% url 'toggle_wishlist' related.variants.first.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ related.id }}">
                        <button class="btn btn-sm btn-outline-danger">❤️</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

</body>
</html> {% endcomment %}

{% comment %} 

<html >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} | Product Details - Gnanow Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #F8FAFC; /* Tailwind slate-50 / neutral.light */
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #edf2f7; /* Tailwind gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0aec0; /* Tailwind gray-500 */
            border-radius: 10px;
            border: 2px solid #edf2f7; /* Tailwind gray-200 - creates padding */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* Tailwind gray-600 */
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wishlist-btn svg, .related-wishlist-btn svg {
            transition: transform 0.25s ease-in-out, fill 0.25s ease-in-out, stroke 0.25s ease-in-out;
        }
        .wishlist-btn:hover svg, .related-wishlist-btn:hover svg {
            transform: scale(1.15);
        }
        .wishlist-btn.active svg, .related-wishlist-btn.active svg {
            fill: #ef4444; /* Red-500 for active wishlist */
            stroke: #ef4444;
        }

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Custom Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 0.875rem;
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease-custom-ease, transform 0.3s ease-custom-ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .toast-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-success { background-color: #10B981; /* emerald-500 */ }
        .toast-info { background-color: #3B82F6; /* blue-500 */ }
        .toast-error { background-color: #EF4444; /* red-500 */ }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', "Noto Sans", 'sans-serif', "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"],
                    },
                    colors: {
                        primary: { DEFAULT: '#0284C7', light: '#03A9F4', dark: '#01579B' }, // sky-600
                        secondary: { DEFAULT: '#14B8A6', light: '#4DB6AC', dark: '#00796B' }, // teal-500
                        accent: { DEFAULT: '#F97316', light: '#FFB74D', dark: '#E65100' }, // orange-500
                        neutral: { light: '#F8FAFC', DEFAULT: '#F1F5F9', medium: '#CBD5E1', dark: '#475569', darker: '#1E293B' }
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.07)',
                        'card-hover': '0 10px 25px rgba(0, 0, 0, 0.1)',
                        'input': '0 1px 3px rgba(0,0,0,0.05) inset, 0 1px 2px rgba(0,0,0,0.03)',
                        'input-focus': '0 0 0 3px rgba(2, 132, 199, 0.25)',
                        'header': '0 2px 8px rgba(0,0,0,0.06)',
                    },
                    transitionTimingFunction: { 'custom-ease': 'cubic-bezier(0.4, 0, 0.2, 1)' },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'pulse-sm': 'pulse-sm 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'subtle-bounce': { '0%, 100%': { transform: 'translateY(-3%)' }, '50%': { transform: 'translateY(0)' } },
                        'pulse-sm': { '0%, 100%': { opacity: '1' }, '50%': { opacity: '.7' } }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-light text-neutral-dark antialiased">

    <header class="bg-white shadow-header"> 
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                <a href="{% url 'product_list' %}" class="text-2xl sm:text-3xl font-extrabold text-primary hover:text-primary-dark transition-colors duration-300 ease-custom-ease">
                    🛒 GnanowShop
                </a>
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <a href="{% url 'view_cart' %}" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Cart">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </a>
                    <a href="{% url 'wishlist' %}" class="text-neutral-dark hover:text-red-500 p-2 rounded-full transition-colors" title="Wishlist">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </a>
                    <a href="#" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Profile"> 
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center">
               
                <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-neutral-darker mb-3 sm:mb-0 truncate" title="{{product.name}}">
                    {{ product.name }}
                </h1>
                <nav class="flex space-x-3 sm:space-x-5 text-sm sm:text-base">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Home</a>
                    <a href="{% url 'product_list' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Products</a>
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors font-medium">Categories</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white p-6 sm:p-8 md:p-10 rounded-xl shadow-card animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12">
                <div class="animate-fade-in" style="animation-delay: 0.1s;">
                    {% if images %}
                        <img src="{{ images.0.image.url }}" class="w-full h-auto max-h-[500px] object-contain rounded-lg shadow-md border border-gray-200" alt="{{ product.name }}"
                             onerror="this.onerror=null;this.src='https://placehold.co/600x500/CBD5E1/475569?text=Image+Not+Found';">
                        {% else %}
                        <img src="https://placehold.co/600x500/CBD5E1/475569?text=No+Image+Available" class="w-full h-auto max-h-[500px] object-contain rounded-lg shadow-md border border-gray-200" alt="No image available">
                    {% endif %}
                </div>

                <div class="flex flex-col justify-center animate-fade-in" style="animation-delay: 0.2s;">
                    <h2 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-3">{{ product.name }}</h2>
                    <p class="text-gray-600 leading-relaxed mb-4 sm:mb-6 text-sm sm:text-base">{{ product.description|linebreaksbr }}</p>

                    {% if first_variant %}
                        <p class="text-3xl sm:text-4xl font-extrabold text-primary mb-5 sm:mb-6">₹{{ first_variant.price }}</p>
                    {% else %}
                        <p class="text-xl text-gray-500 mb-6">Price not available</p>
                    {% endif %}

                    <form method="post" action="{% if first_variant %}{% url 'add_to_cart' first_variant.id %}{% else %}#{% endif %}" id="product-detail-form">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
                            <div>
                                <label for="color" class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                <select name="color" id="color" class="w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm">
                                    {% for variant in variants %}
                                        <option value="{{ variant.color }}" {% if first_variant and variant.color == first_variant.color %}selected{% endif %}>{{ variant.color_name|default:variant.color }}</option>
                                    {% empty %}
                                        <option value="">Not available</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="size" class="block text-sm font-medium text-gray-700 mb-1">Size</label>
                                <select name="size" id="size" class="w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm">
                                    {% for variant in variants %}
                                        <option value="{{ variant.size }}" {% if first_variant and variant.size == first_variant.size %}selected{% endif %}>{{ variant.size_name|default:variant.size }}</option>
                                    {% empty %}
                                        <option value="">Not available</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                            <input type="number" name="quantity" id="quantity" class="w-24 px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm text-center" value="1" min="1" max="{{ first_variant.stock|default:1 }}">
                        </div>
                        
                        {% if first_variant %}
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                            <button type="submit" class="w-full sm:w-auto flex-grow bg-primary text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg flex items-center justify-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <span>Add to Cart</span>
                            </button>
                            <button type="button" id="main-wishlist-btn"
                                    class="wishlist-btn w-full sm:w-auto flex-grow bg-gray-100 text-neutral-dark py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 focus:ring-offset-1 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg flex items-center justify-center space-x-2 {% if first_variant.id in wishlist_variant_ids %}active{% endif %}"
                                    data-variant-id="{{ first_variant.id }}"
                                    data-url="{% url 'toggle_wishlist' first_variant.id %}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                                <span class="wishlist-text">{% if first_variant.id in wishlist_variant_ids %}In Wishlist{% else %}Add to Wishlist{% endif %}</span>
                            </button>
                        </div>
                        {% else %}
                        <p class="text-red-600 font-medium">This product variant is currently unavailable.</p>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>

        {% if related_products %}
        <div class="mt-16 sm:mt-20 animate-fade-in" style="animation-delay: 0.3s;">
            <h3 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-6 sm:mb-8">Related Products</h3>
            <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
                {% for related in related_products %}
                <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" style="animation-delay:0.1">
                    {% with related_first_variant=related.variants.first %}
                    <a href="{% url 'product_detail' related.slug %}" class="block relative overflow-hidden rounded-t-xl">
                        {% if related_first_variant.images.first %}
                            <img src="{{ related_first_variant.images.first.image.url }}" alt="{{ related.name }}" class="w-full h-56 sm:h-60 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease"
                                 onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                        {% else %}
                            <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available" class="w-full h-56 sm:h-60 object-cover">
                        {% endif %}
                    </a>
                    <div class="p-4 flex flex-col flex-grow">
                        <h4 class="text-base font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors" title="{{ related.name }}">
                            <a href="{% url 'product_detail' related.slug %}">{{ related.name }}</a>
                        </h4>
                        <p class="text-lg font-bold text-primary mb-2">₹{{ related_first_variant.price }}</p>
                        <div class="flex items-center justify-between mb-3">
                             <p class="text-xs text-accent flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-0.5 text-accent-dark" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                {{ related.avg_rating|default:"4.5" }}
                            </p>
                            <button class="related-wishlist-btn text-gray-400 hover:text-red-500 p-0.5 rounded-full transition-colors duration-200 {% if related_first_variant.id in wishlist_variant_ids %}active{% endif %}"
                                    data-variant-id="{{ related_first_variant.id }}"
                                    data-url="{% url 'toggle_wishlist' related_first_variant.id %}"
                                    title="Toggle Wishlist">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                            </button>
                        </div>
                        <div class="mt-auto space-y-2">
                            <form method="post" action="{% url 'add_to_cart' related_first_variant.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ related.id }}">
                                <input type="hidden" name="quantity" value="1">
                                <button type="submit" class="w-full bg-primary text-white py-2 px-3 rounded-md font-semibold hover:bg-primary-dark transition-all text-xs transform hover:scale-105 flex items-center justify-center space-x-1.5">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                    <span>Add</span>
                                </button>
                            </form>
                            <a href="{% url 'product_detail' related.slug %}" class="block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark transition-all text-xs transform hover:scale-105">View</a>
                        </div>
                    </div>
                    {% endwith %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </main>

    <footer class="bg-neutral-darker text-gray-300 mt-20 py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                <div>
                    <h3 class="text-2xl font-bold text-primary mb-4">GnanowShop</h3>
                    <p class="text-sm text-gray-400 leading-relaxed">Discover amazing products with Gnanow. Quality and value, delivered to your doorstep.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Shop</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="{% url 'product_list' %}" class="text-gray-400 hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Best Sellers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Sales & Offers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Customer Service</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">FAQs</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Shipping Information</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">...</svg></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">...</svg></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">...</svg></a>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} GnanowShop. All rights reserved.</p>
                <p class="mt-1 text-gray-500">Designed with <span class="text-red-500 animate-pulse-sm">♥</span> by Gnanow AI & Tailwind CSS.</p>
            </div>
        </div>
    </footer>

    <div id="toast-container" class="fixed bottom-5 right-5 z-[10000] space-y-2"></div>


    <script>
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast-notification ${type === 'success' ? 'toast-success' : type === 'error' ? 'toast-error' : 'toast-info'}`;
            toast.textContent = message;
            
            container.appendChild(toast);

            // Trigger reflow to enable animation
            toast.offsetHeight; 

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode === container) { // Check if still child before removing
                       container.removeChild(toast);
                    }
                }, 300); // Allow fade out animation
            }, 3000); // Display toast for 3 seconds
        }

        function handleWishlistToggle(buttonEl) {
            const url = buttonEl.dataset.url;
            const variantId = buttonEl.dataset.variantId;
            const wishlistTextEl = buttonEl.querySelector('.wishlist-text'); // For main product page button

            if (!url || !variantId) {
                console.error('Wishlist button missing data-url or data-variant-id');
                return;
            }

            const isActiveBeforeRequest = buttonEl.classList.contains('active');
            // Optimistic UI update
            buttonEl.classList.toggle('active');
            if (wishlistTextEl) {
                wishlistTextEl.textContent = buttonEl.classList.contains('active') ? 'In Wishlist' : 'Add to Wishlist';
            }

            const svg = buttonEl.querySelector('svg');
            if (svg) {
                if (buttonEl.classList.contains('active')) {
                    svg.classList.add('animate-subtle-bounce');
                } else {
                    svg.classList.remove('animate-subtle-bounce');
                }
            }
            
            fetch(url, {
                method: 'GET', // Or 'POST', ensure your Django view matches
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errData => { throw new Error(errData.message || `Server error: ${response.status}`); });
                }
                return response.json();
            })
            .then(data => {
                console.log('Wishlist toggle response:', data);
                if (data.status === 'success') {
                    if (data.added) {
                        buttonEl.classList.add('active');
                        if (wishlistTextEl) wishlistTextEl.textContent = 'In Wishlist';
                        if (svg) svg.classList.add('animate-subtle-bounce');
                        showToast('Added to wishlist!', 'success');
                    } else {
                        buttonEl.classList.remove('active');
                        if (wishlistTextEl) wishlistTextEl.textContent = 'Add to Wishlist';
                        if (svg) svg.classList.remove('animate-subtle-bounce');
                        showToast('Removed from wishlist.', 'info');
                    }
                } else {
                    // Revert optimistic update on server error
                    buttonEl.classList.toggle('active', isActiveBeforeRequest);
                    if (wishlistTextEl) {
                        wishlistTextEl.textContent = isActiveBeforeRequest ? 'In Wishlist' : 'Add to Wishlist';
                    }
                    if (svg) {
                         buttonEl.classList.contains('active') ? svg.classList.add('animate-subtle-bounce') : svg.classList.remove('animate-subtle-bounce');
                    }
                    showToast(data.message || 'Could not update wishlist.', 'error');
                }
            })
            .catch(error => {
                console.error('Error toggling wishlist:', error);
                // Revert optimistic update on network/client error
                buttonEl.classList.toggle('active', isActiveBeforeRequest);
                if (wishlistTextEl) {
                    wishlistTextEl.textContent = isActiveBeforeRequest ? 'In Wishlist' : 'Add to Wishlist';
                }
                if (svg) {
                    buttonEl.classList.contains('active') ? svg.classList.add('animate-subtle-bounce') : svg.classList.remove('animate-subtle-bounce');
                }
                showToast('An error occurred. Please try again.', 'error');
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const mainWishlistButton = document.getElementById('main-wishlist-btn');
            if (mainWishlistButton) {
                mainWishlistButton.addEventListener('click', function() {
                    handleWishlistToggle(this);
                });
            }

            const relatedWishlistButtons = document.querySelectorAll('.related-wishlist-btn');
            relatedWishlistButtons.forEach(button => {
                button.addEventListener('click', function() {
                    handleWishlistToggle(this);
                });
            });
        });

    </script>

</body>
</html> {% endcomment %}

{% comment %} 
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} | Product Details - Gnanow Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #F8FAFC; /* Tailwind slate-50 / neutral.light */
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #edf2f7; /* Tailwind gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0aec0; /* Tailwind gray-500 */
            border-radius: 10px;
            border: 2px solid #edf2f7; /* Tailwind gray-200 - creates padding */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* Tailwind gray-600 */
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wishlist-btn svg, .related-wishlist-btn svg {
            transition: transform 0.25s ease-in-out, fill 0.25s ease-in-out, stroke 0.25s ease-in-out;
        }
        .wishlist-btn:hover svg, .related-wishlist-btn:hover svg {
            transform: scale(1.15);
        }
        .wishlist-btn.active svg, .related-wishlist-btn.active svg {
            fill: #ef4444; /* Red-500 for active wishlist */
            stroke: #ef4444;
        }

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Custom Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 0.875rem;
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Use custom-ease from Tailwind config */
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .toast-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-success { background-color: #10B981; /* emerald-500 */ }
        .toast-info { background-color: #3B82F6; /* blue-500 */ }
        .toast-error { background-color: #EF4444; /* red-500 */ }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', "Noto Sans", 'sans-serif', "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"],
                    },
                    colors: {
                        primary: { DEFAULT: '#0284C7', light: '#03A9F4', dark: '#01579B' }, // sky-600
                        secondary: { DEFAULT: '#14B8A6', light: '#4DB6AC', dark: '#00796B' }, // teal-500
                        accent: { DEFAULT: '#F97316', light: '#FFB74D', dark: '#E65100' }, // orange-500
                        neutral: { light: '#F8FAFC', DEFAULT: '#F1F5F9', medium: '#CBD5E1', dark: '#475569', darker: '#1E293B' }
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.07)',
                        'card-hover': '0 10px 25px rgba(0, 0, 0, 0.1)',
                        'input': '0 1px 3px rgba(0,0,0,0.05) inset, 0 1px 2px rgba(0,0,0,0.03)',
                        'input-focus': '0 0 0 3px rgba(2, 132, 199, 0.25)',
                        'header': '0 2px 8px rgba(0,0,0,0.06)',
                    },
                    transitionTimingFunction: { 'custom-ease': 'cubic-bezier(0.4, 0, 0.2, 1)' },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'pulse-sm': 'pulse-sm 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'subtle-bounce': { '0%, 100%': { transform: 'translateY(-3%)' }, '50%': { transform: 'translateY(0)' } },
                        'pulse-sm': { '0%, 100%': { opacity: '1' }, '50%': { opacity: '.7' } }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-light text-neutral-dark antialiased">

    <header class="bg-white shadow-header"> 
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                <a href="{% url 'product_list' %}" class="text-2xl sm:text-3xl font-extrabold text-primary hover:text-primary-dark transition-colors duration-300 ease-custom-ease">
                    🛒 GnanowShop
                </a>
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <a href="{% url 'view_cart' %}" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Cart">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </a>
                    <a href="{% url 'wishlist' %}" class="text-neutral-dark hover:text-red-500 p-2 rounded-full transition-colors" title="Wishlist">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </a>
                    <a href="#" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Profile"> 
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                
                <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-neutral-darker mb-3 sm:mb-0 truncate" title="{{product.name}}">
                    {{ product.name }}
                </h1>
                <nav class="flex space-x-3 sm:space-x-5 text-sm sm:text-base">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Home</a>
                    <a href="{% url 'product_list' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Products</a>
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors font-medium">Categories</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white p-6 sm:p-8 md:p-10 rounded-xl shadow-card animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12">
                <div class="animate-fade-in" style="animation-delay: 0.1s;">
                    {% if images %}
                        <img src="{{ images.0.image.url }}" class="w-full h-auto max-h-[500px] object-contain rounded-lg shadow-md border border-gray-200" alt="{{ product.name }}"
                             onerror="this.onerror=null;this.src='https://placehold.co/600x500/CBD5E1/475569?text=Image+Not+Found';">
                        {% else %}
                        <img src="https://placehold.co/600x500/CBD5E1/475569?text=No+Image+Available" class="w-full h-auto max-h-[500px] object-contain rounded-lg shadow-md border border-gray-200" alt="No image available">
                    {% endif %}
                </div>

                <div class="flex flex-col justify-center animate-fade-in" style="animation-delay: 0.2s;">
                    <h2 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-3">{{ product.name }}</h2>
                    <p class="text-gray-600 leading-relaxed mb-4 sm:mb-6 text-sm sm:text-base">{{ product.description|linebreaksbr }}</p>

                    {% if first_variant %}
                        <p class="text-3xl sm:text-4xl font-extrabold text-primary mb-5 sm:mb-6">₹{{ first_variant.price }}</p>
                    {% else %}
                        <p class="text-xl text-gray-500 mb-6">Price not available</p>
                    {% endif %}

                    <form method="post" action="{% if first_variant %}{% url 'add_to_cart' first_variant.id %}{% else %}#{% endif %}" id="product-detail-form">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
                            <div>
                                <label for="color" class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                <select name="color" id="color" class="w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm">
                                    {% for variant in variants %}
                                        <option value="{{ variant.color }}" {% if first_variant and variant.color == first_variant.color %}selected{% endif %}>{{ variant.color_name|default:variant.color }}</option>
                                    {% empty %}
                                        <option value="">Not available</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="size" class="block text-sm font-medium text-gray-700 mb-1">Size</label>
                                <select name="size" id="size" class="w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm">
                                    {% for variant in variants %}
                                        <option value="{{ variant.size }}" {% if first_variant and variant.size == first_variant.size %}selected{% endif %}>{{ variant.size_name|default:variant.size }}</option>
                                    {% empty %}
                                        <option value="">Not available</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                            <input type="number" name="quantity" id="quantity" class="w-24 px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm text-center" value="1" min="1" max="{{ first_variant.stock|default:1 }}">
                        </div>
                        
                        {% if first_variant %}
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                            <button type="submit" class="w-full sm:w-auto flex-grow bg-primary text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg flex items-center justify-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <span>Add to Cart</span>
                            </button>
                            <button type="button" id="main-wishlist-btn"
                                    class="wishlist-btn w-full sm:w-auto flex-grow bg-gray-100 text-neutral-dark py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 focus:ring-offset-1 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg flex items-center justify-center space-x-2 {% if first_variant.id in wishlist_variant_ids %}active{% endif %}"
                                    data-variant-id="{{ first_variant.id }}"
                                    data-url="{% url 'toggle_wishlist' first_variant.id %}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                                <span class="wishlist-text">{% if first_variant.id in wishlist_variant_ids %}In Wishlist{% else %}Add to Wishlist{% endif %}</span>
                            </button>
                        </div>
                        {% else %}
                        <p class="text-red-600 font-medium">This product variant is currently unavailable.</p>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>

        {% if related_products %}
        <div class="mt-16 sm:mt-20 animate-fade-in" style="animation-delay: 0.3s;">
            <h3 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-6 sm:mb-8">Related Products</h3>
            <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
                {% for related in related_products %}
                <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" style="animation-delay:0.1">
                    {% with related_first_variant=related.variants.first %}
                    <a href="{% url 'product_detail' related.slug %}" class="block relative overflow-hidden rounded-t-xl">
                        {% if related_first_variant.images.first %}
                            <img src="{{ related_first_variant.images.first.image.url }}" alt="{{ related.name }}" class="w-full h-56 sm:h-60 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease"
                                 onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                        {% else %}
                            <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available" class="w-full h-56 sm:h-60 object-cover">
                        {% endif %}
                    </a>
                    <div class="p-4 flex flex-col flex-grow">
                        <h4 class="text-base font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors" title="{{ related.name }}">
                            <a href="{% url 'product_detail' related.slug %}">{{ related.name }}</a>
                        </h4>
                        <p class="text-lg font-bold text-primary mb-2">₹{{ related_first_variant.price }}</p>
                        <div class="flex items-center justify-between mb-3">
                             <p class="text-xs text-accent flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-0.5 text-accent-dark" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                {{ related.avg_rating|default:"4.5" }}
                            </p>
                            <button class="related-wishlist-btn text-gray-400 hover:text-red-500 p-0.5 rounded-full transition-colors duration-200 {% if related_first_variant.id in wishlist_variant_ids %}active{% endif %}"
                                    data-variant-id="{{ related_first_variant.id }}"
                                    data-url="{% url 'toggle_wishlist' related_first_variant.id %}"
                                    title="Toggle Wishlist">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                            </button>
                        </div>
                        <div class="mt-auto space-y-2">
                            <form method="post" action="{% url 'add_to_cart' related_first_variant.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ related.id }}">
                                <input type="hidden" name="quantity" value="1">
                                <button type="submit" class="w-full bg-primary text-white py-2 px-3 rounded-md font-semibold hover:bg-primary-dark transition-all text-xs transform hover:scale-105 flex items-center justify-center space-x-1.5">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                     <span>Add</span>
                                </button>
                            </form>
                            <a href="{% url 'product_detail' related.slug %}" class="block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark transition-all text-xs transform hover:scale-105">View</a>
                        </div>
                    </div>
                    {% endwith %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </main>

    <footer class="bg-neutral-darker text-gray-300 mt-20 py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                <div>
                    <h3 class="text-2xl font-bold text-primary mb-4">GnanowShop</h3>
                    <p class="text-sm text-gray-400 leading-relaxed">Discover amazing products with Gnanow. Quality and value, delivered to your doorstep.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Shop</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="{% url 'product_list' %}" class="text-gray-400 hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Best Sellers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Sales & Offers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Customer Service</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">FAQs</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Shipping Information</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.272.058 2.166.248 2.914.552.782.317 1.41.707 2.062 1.358.65.651 1.04 1.28 1.357 2.062.304.748.494 1.642.552 2.914.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.058 1.272-.248 2.166-.552 2.914-.317.782-.707 1.41-1.358 2.062-.651.65-1.28 1.04-2.062 1.357-.748.304-1.642.494-2.914.552-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.272-.058-2.166-.248-2.914-.552-.782-.317-1.41-.707-2.062-1.358-.65-.651-1.04-1.28-1.357-2.062-.304-.748-.494-1.642-.552-2.914-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.058-1.272.248-2.166.552-2.914.317-.782.707-1.41 1.358-2.062.651-.65 1.28-1.04 2.062-1.357.748-.304 1.642-.494 2.914-.552A17.936 17.936 0 0112 2.163zm0 1.802c-3.144 0-3.502.012-4.728.068-1.186.054-1.91.23-2.448.444-.586.236-.99.56-1.42.99-.43.43-.754.834-.99 1.42-.213.538-.39 1.262-.443 2.448C2.012 8.498 2 8.856 2 12s.012 3.502.068 4.728c.054 1.186.23 1.91.443 2.448.236.586.56.99.99 1.42.43.43.834.754 1.42.99.538.213 1.262.39 2.448.443C8.498 21.988 8.856 22 12 22s3.502-.012 4.728-.068c1.186-.054 1.91-.23 2.448-.443.586-.236.99-.56 1.42-.99.43-.43.754-.834.99-1.42.213-.538.39-1.262.443-2.448.056-1.226.068-1.584.068-4.728s-.012-3.502-.068-4.728c-.054-1.186-.23-1.91-.443-2.448-.236-.586-.56-.99-.99-1.42-.43-.43-.834-.754-1.42-.99-.538-.213-1.262-.39-2.448-.443A16.145 16.145 0 0012 3.965zm0 2.98c-2.761 0-5 2.239-5 5s2.239 5 5 5 5-2.239 5-5-2.239-5-5-5zm0 8.15c-1.737 0-3.15-1.413-3.15-3.15s1.413-3.15 3.15-3.15 3.15 1.413 3.15 3.15-1.413 3.15-3.15 3.15zm5.25-8.093c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25z"></path></svg></a>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} GnanowShop. All rights reserved.</p>
                <p class="mt-1 text-gray-500">Designed with <span class="text-red-500 animate-pulse-sm">♥</span> by Gnanow AI & Tailwind CSS.</p>
            </div>
        </div>
    </footer>

    <div id="toast-container" class="fixed bottom-5 right-5 z-[10000] space-y-2"></div>


    <script>
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast-notification ${type === 'success' ? 'toast-success' : type === 'error' ? 'toast-error' : 'toast-info'}`;
            toast.textContent = message;
            
            container.appendChild(toast);

            // Trigger reflow to enable animation
            toast.offsetHeight; 

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode === container) { // Check if still child before removing
                        container.removeChild(toast);
                    }
                }, 300); // Allow fade out animation
            }, 3000); // Display toast for 3 seconds
        }

       function handleWishlistToggle(buttonEl) {
            const url = buttonEl.dataset.url;
            const variantId = buttonEl.dataset.variantId;
            const wishlistTextEl = buttonEl.querySelector('.wishlist-text'); // For main product page button

            if (!url || !variantId) {
                console.error('Wishlist button missing data-url or data-variant-id');
                showToast('Could not update wishlist. Button data missing.', 'error');
                return;
            }

            const isActiveBeforeRequest = buttonEl.classList.contains('active');
            // Optimistic UI update
            buttonEl.classList.toggle('active');
            if (wishlistTextEl) {
                wishlistTextEl.textContent = buttonEl.classList.contains('active') ? 'In Wishlist' : 'Add to Wishlist';
            }

            const svg = buttonEl.querySelector('svg');
            if (svg) {
                if (buttonEl.classList.contains('active')) {
                    svg.classList.add('animate-subtle-bounce');
                } else {
                    svg.classList.remove('animate-subtle-bounce');
                }
            }
            
            fetch(url, {
                method: 'GET', // Or 'POST', ensure your Django view matches
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // Important for POST, less so for GET but good practice
                    'X-Requested-With': 'XMLHttpRequest', // Helps Django identify AJAX requests
                    'Accept': 'application/json' // Tell the server we prefer JSON
                }
            })
            .then(response => {
                const contentType = response.headers.get("content-type");
                if (response.ok && contentType && contentType.includes("application/json")) {
                    return response.json();
                } else if (!response.ok) {
                    // If response is not OK, try to get text for more info, then throw error
                    return response.text().then(text => {
                        throw new Error(text || `Server error: ${response.status}`);
                    });
                } else {
                    // If response is OK but not JSON, it's an unexpected response type
                    return response.text().then(text => { // Get the HTML/text content
                        console.error('Unexpected response type. Expected JSON, got:', text);
                        throw new Error('Unexpected response from server. Expected JSON.');
                    });
                }
            })
            .then(data => {
                // This block now only runs if response.json() was successful
                console.log('Wishlist toggle response:', data);
                if (data.status === 'success') {
                    if (data.added) {
                        buttonEl.classList.add('active');
                        if (wishlistTextEl) wishlistTextEl.textContent = 'In Wishlist';
                        if (svg) svg.classList.add('animate-subtle-bounce');
                        showToast(data.message || 'Added to wishlist!', 'success');
                    } else {
                        buttonEl.classList.remove('active');
                        if (wishlistTextEl) wishlistTextEl.textContent = 'Add to Wishlist';
                        if (svg) svg.classList.remove('animate-subtle-bounce');
                        showToast(data.message || 'Removed from wishlist.', 'info');
                    }
                } else { // JSON response, but with status: 'error'
                    buttonEl.classList.toggle('active', isActiveBeforeRequest); // Revert
                    if (wishlistTextEl) {
                        wishlistTextEl.textContent = isActiveBeforeRequest ? 'In Wishlist' : 'Add to Wishlist';
                    }
                     if (svg) {
                         isActiveBeforeRequest ? svg.classList.add('animate-subtle-bounce') : svg.classList.remove('animate-subtle-bounce');
                    }
                    showToast(data.message || 'Could not update wishlist.', 'error');
                }
            })
            .catch(error => {
                console.error('Error toggling wishlist:', error.message); // Log the actual error message
                // Revert optimistic update on network/client error or non-JSON response
                buttonEl.classList.toggle('active', isActiveBeforeRequest);
                if (wishlistTextEl) {
                    wishlistTextEl.textContent = isActiveBeforeRequest ? 'In Wishlist' : 'Add to Wishlist';
                }
                if (svg) {
                    isActiveBeforeRequest ? svg.classList.add('animate-subtle-bounce') : svg.classList.remove('animate-subtle-bounce');
                }
                // Check if error.message already contains a server message (from the new error handling)
                if (error.message.includes("Server error:") || error.message.includes("Expected JSON.")) { // Added dot
                    showToast(error.message, 'error');
                } else {
                    showToast('An error occurred. Please check console or try again.', 'error');
                }
            });
        } 

        {% comment % document.addEventListener('DOMContentLoaded', () => {
            const mainWishlistButton = document.getElementById('main-wishlist-btn');
            if (mainWishlistButton) {
                mainWishlistButton.addEventListener('click', function() {
                    handleWishlistToggle(this);
                });
            {% comment %} }  {% endcomment %

           const relatedWishlistButtons = document.querySelectorAll('.related-wishlist-btn');
            relatedWishlistButtons.forEach(button => {
                button.addEventListener('click', function() {
                    handleWishlistToggle(this);
                });
            });
        }); 

    </script>

</body>
</html> {% endcomment %}


{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} | Product Details - Gnanow Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #F8FAFC; /* Tailwind slate-50 / neutral.light */
        }

        .custom-alert {
      position: fixed;
      top: 20px;
      right: -400px;
      background-color: #f0f0f0;
      color: #333;
      padding: 16px 50px 16px 20px;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      font-size: 16px;
      z-index: 1000;
      transition: right 0.6s ease, opacity 0.5s ease;
      opacity: 0;
      min-width: 250px;
      max-width: 300px;
    }

    .custom-alert.show {
      right: 20px;
      opacity: 1;
    }

    .custom-alert .close-btn {
      position: absolute;
      top: 50%;
      right: 15px;
      transform: translateY(-50%);
      color: red;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
    }

    .custom-alert .close-btn:hover {
      color: darkred;
    } 
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #edf2f7; /* Tailwind gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a0aec0; /* Tailwind gray-500 */
            border-radius: 10px;
            border: 2px solid #edf2f7; /* Tailwind gray-200 - creates padding */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* Tailwind gray-600 */
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wishlist-btn svg, .related-wishlist-btn svg {
            transition: transform 0.25s ease-in-out, fill 0.25s ease-in-out, stroke 0.25s ease-in-out;
        }
        .wishlist-btn:hover svg, .related-wishlist-btn:hover svg {
            transform: scale(1.15);
        }
        .wishlist-btn.active svg, .related-wishlist-btn.active svg {
            fill: #ef4444; /* Red-500 for active wishlist */
            stroke: #ef4444;
        }

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Custom Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 0.875rem;
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Use custom-ease from Tailwind config */
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .toast-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-success { background-color: #10B981; /* emerald-500 */ }
        .toast-info { background-color: #3B82F6; /* blue-500 */ }
        .toast-error { background-color: #EF4444; /* red-500 */ }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', "Noto Sans", 'sans-serif', "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"],
                    },
                    colors: {
                        primary: { DEFAULT: '#0284C7', light: '#03A9F4', dark: '#01579B' }, // sky-600
                        secondary: { DEFAULT: '#14B8A6', light: '#4DB6AC', dark: '#00796B' }, // teal-500
                        accent: { DEFAULT: '#F97316', light: '#FFB74D', dark: '#E65100' }, // orange-500
                        neutral: { light: '#F8FAFC', DEFAULT: '#F1F5F9', medium: '#CBD5E1', dark: '#475569', darker: '#1E293B' }
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.07)',
                        'card-hover': '0 10px 25px rgba(0, 0, 0, 0.1)',
                        'input': '0 1px 3px rgba(0,0,0,0.05) inset, 0 1px 2px rgba(0,0,0,0.03)',
                        'input-focus': '0 0 0 3px rgba(2, 132, 199, 0.25)',
                        'header': '0 2px 8px rgba(0,0,0,0.06)',
                    },
                    transitionTimingFunction: { 'custom-ease': 'cubic-bezier(0.4, 0, 0.2, 1)' },
                    animation: {
                        'subtle-bounce': 'subtle-bounce 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'pulse-sm': 'pulse-sm 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'subtle-bounce': { '0%, 100%': { transform: 'translateY(-3%)' }, '50%': { transform: 'translateY(0)' } },
                        'pulse-sm': { '0%, 100%': { opacity: '1' }, '50%': { opacity: '.7' } }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-light text-neutral-dark antialiased">
  {% if status == "1" or status == "0" %}
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const alert = document.createElement('div');
        alert.className = 'custom-alert';

        {% if status == "1" %}
          alert.innerHTML = `Item added to wishlist! <span class="close-btn" onclick="this.parentElement.remove()">×</span>`;
          alert.style.backgroundColor = '#d4edda';
          alert.style.color = 'green';
        {% elif status == "0" %}
          alert.innerHTML = `Item removed from wishlist. <span class="close-btn" onclick="this.parentElement.remove()">×</span>`;
          alert.style.backgroundColor = '#f8d7da';
          alert.style.color = 'red';
                {% endif %}

        document.body.appendChild(alert);

        setTimeout(() => {
          alert.classList.add('show');
        }, 100);

        setTimeout(() => {
          alert.classList.remove('show');
          setTimeout(() => alert.remove(), 500);
        }, 30000);
      });
    </script>
  {% endif %}
    <header class="bg-white shadow-header"> 
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                <a href="{% url 'product_list' %}" class="text-2xl sm:text-3xl font-extrabold text-primary hover:text-primary-dark transition-colors duration-300 ease-custom-ease">
                    🛒 GnanowShop
                </a>
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <a href="{% url 'view_cart' %}" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Cart">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </a>
                    <a href="{% url 'wishlist' %}" class="text-neutral-dark hover:text-red-500 p-2 rounded-full transition-colors" title="Wishlist">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </a>
                    <a href="#" class="text-neutral-dark hover:text-primary p-2 rounded-full transition-colors" title="Profile"> 
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                
                <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-neutral-darker mb-3 sm:mb-0 truncate" title="{{product.name}}">
                    {{ product.name }}
                </h1>
                <nav class="flex space-x-3 sm:space-x-5 text-sm sm:text-base">
                    <a href="{% url 'dashboard' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Home</a>
                    <a href="{% url 'product_list' %}" class="text-gray-600 hover:text-primary transition-colors font-medium">Products</a>
                    <a href="/categories" class="text-gray-600 hover:text-primary transition-colors font-medium">Categories</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white p-6 sm:p-8 md:p-10 rounded-xl shadow-card animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12">
                <div class="animate-fade-in" style="animation-delay: 0.1s;">
                    {% if images %}
                    {% if first_variant.stock == 0 %}
    <span class="absolute top-7 right-11 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">Out of Stock</span>
{% endif %}
                        <img src="{{ images.0.image.url }}" class="w-full h-auto max-h-[500px] object-contain rounded-lg shadow-md border border-gray-200" alt="{{ product.name }}"
                             onerror="this.onerror=null;this.src='https://placehold.co/600x500/CBD5E1/475569?text=Image+Not+Found';">
                        {% else %}
                        <img src="https://placehold.co/600x500/CBD5E1/475569?text=No+Image+Available" class="w-full h-auto max-h-[500px] object-contain rounded-lg shadow-md border border-gray-200" alt="No image available">
                    {% endif %}
                    
                </div>

                <div class="flex flex-col justify-center animate-fade-in" style="animation-delay: 0.2s;">
                    <h2 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-3">{{ product.name }}</h2>
                    <p class="text-gray-600 leading-relaxed mb-4 sm:mb-6 text-sm sm:text-base">{{ product.description|linebreaksbr }}</p>

                    {% if first_variant %}
                        <p class="text-3xl sm:text-4xl font-extrabold text-primary mb-5 sm:mb-6">₹{{ first_variant.price }}</p>
                    {% else %}
                        <p class="text-xl text-gray-500 mb-6">Price not available</p>
                    {% endif %}
                          {% comment %} <form method="post" action="{% if first_variant and first_variant.stock > 0 %}{% url 'add_to_cart' first_variant.id %}{% else %}#{% endif %}" id="product-detail-form"> {% endcomment %}
    <form method="post" action="{% if first_variant %}{% url 'add_to_cart' first_variant.id %}{% else %}#{% endif %}">

                          {% csrf_token %}
    <input type="hidden" name="product_id" value="{{ product.id }}">

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
        <div>
            <label for="color" class="block text-sm font-medium text-gray-700 mb-1">Color</label>
            {% comment %} <select name="color" id="color" class="w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm">
                {% for variant in variants %}
                    <option value="{{ variant.color }}" {% if first_variant and variant.color == first_variant.color %}selected{% endif %}>{{ variant.color_name|default:variant.color }}</option>
                {% empty %}
                    <option value="">Not available</option>
                {% endfor %}
            </select> {% endcomment %}
            <select name="color" id="color">
  {% for variant in variants|dictsort:"color" %}
    <option value="{{ variant.color }}" {% if first_variant.color == variant.color %}selected{% endif %}>{{ variant.color }}</option>
  {% endfor %}
</select>
        </div>
        <div>
            <label for="size" class="block text-sm font-medium text-gray-700 mb-1">Size</label>
            {% comment %} <select name="size" id="size" class="w-full px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm">
                {% for variant in variants %}
                    <option value="{{ variant.size }}" {% if first_variant and variant.size == first_variant.size %}selected{% endif %}>{{ variant.size_name|default:variant.size }}</option>
                {% empty %}
                    <option value="">Not available</option>
                {% endfor %}
            </select> {% endcomment %}
            <select name="size" id="size">
  {% for variant in variants|dictsort:"size" %}
    <option value="{{ variant.size }}" {% if first_variant.size == variant.size %}selected{% endif %}>{{ variant.size }}</option>
  {% endfor %}
</select>
        </div>
    </div>

    <div class="mb-6">
        <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
        <input type="number" name="quantity" id="quantity" class="w-24 px-3 py-2.5 text-gray-700 bg-neutral-light border border-neutral-medium rounded-md focus:ring-1 focus:ring-primary focus:border-primary transition shadow-sm text-sm text-center" value="1" min="1" max="{{ first_variant.stock|default:1 }}" {% if first_variant.stock == 0 %}disabled{% endif %}>
    </div>

    {% if first_variant %}
    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
        <button type="submit" class="w-full sm:w-auto flex-grow bg-primary text-white py-3 px-6 rounded-lg font-semibold focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 focus:ring-offset-2 transition-all transform duration-300 ease-custom-ease shadow-md flex items-center justify-center space-x-2 {% if first_variant.stock == 0 %}opacity-50 cursor-not-allowed{% endif %}" {% if first_variant.stock == 0 %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>{% if first_variant.stock > 0 %}Add to Cart{% else %}Out of Stock{% endif %}</span>
        </button>
    </div>
   {% if first_variant.stock == 0 %}
    <span class="absolute bottom-2 left-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">Out of Stock</span>
{% endif %}
</form>
                            <br>
                            <form action="{% url 'toggle_wishlist_p_details' first_variant.id  %}" method="post" class="wishlist-btn w-full sm:w-auto flex-grow bg-gray-50 text-neutral-dark py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 focus:ring-offset-1 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg flex items-center justify-center space-x-2 ">
    {% csrf_token %} {# Add this for POST requests in Django #}
    <button type="submit"  class="wishlist-btn w-full sm:w-auto flex-grow bg-gray-100 text-neutral-dark py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 focus:ring-offset-1 transition-all transform hover:scale-105 duration-300 ease-custom-ease shadow-md hover:shadow-lg flex items-center justify-center space-x-2 ">Add to Wishlist</button>
</form>





                        </div>
                        {% else %}
                        <p class="text-red-600 font-medium">This product variant is currently unavailable.</p>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>

        {% if related_products %}
        <div class="mt-16 sm:mt-20 animate-fade-in" style="animation-delay: 0.3s;">
            <h3 class="text-2xl sm:text-3xl font-bold text-neutral-darker mb-6 sm:mb-8">Related Products</h3>
            <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-8">
                {% for related in related_products %}
                <div class="product-card group bg-white rounded-xl border border-gray-200 hover:shadow-card-hover transition-all duration-300 ease-custom-ease flex flex-col overflow-hidden animate-fade-in" style="animation-delay:0.1">
                    {% with related_first_variant=related.variants.first %}
                    <a href="{% url 'product_detail' related.slug %}" class="block relative overflow-hidden rounded-t-xl">
                        {% if related_first_variant.images.first %}
                            <img src="{{ related_first_variant.images.first.image.url }}" alt="{{ related.name }}" class="w-full h-56 sm:h-60 object-cover transform group-hover:scale-105 transition-transform duration-350 ease-custom-ease"
                                 onerror="this.onerror=null;this.src='https://placehold.co/400x300/CBD5E1/475569?text=No+Image';">
                        {% else %}
                            <img src="https://placehold.co/400x300/CBD5E1/475569?text=No+Image" alt="No image available" class="w-full h-56 sm:h-60 object-cover">
                        {% endif %}
                    </a>
                    <div class="p-4 flex flex-col flex-grow">
                        <h4 class="text-base font-semibold text-neutral-darker mb-1 truncate group-hover:text-primary transition-colors" title="{{ related.name }}">
                            <a href="{% url 'product_detail' related.slug %}">{{ related.name }}</a>
                        </h4>
                        <p class="text-lg font-bold text-primary mb-2">₹{{ related_first_variant.price }}</p>
                        <div class="flex items-center justify-between mb-3">
                             <p class="text-xs text-accent flex items-center">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-0.5 text-accent-dark" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                 {{ related.avg_rating|default:"4.5" }}
                             </p>
                            <form action="{% url 'toggle_wishlist_p_details' related_first_variant.id %}" method="post" class="inline">
    {% csrf_token %} {# Add this for POST requests in Django #}
    <button type="submit"
            class="related-wishlist-btn text-gray-400 hover:text-red-500 p-0.5 rounded-full transition-colors duration-200 {% if related_first_variant.id in wishlist_variant_ids %}active{% endif %}"
            data-variant-id="{{ related_first_variant.id }}"
            title="Toggle Wishlist">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
    </button>
</form>
                        </div>
                        <div class="mt-auto space-y-2">
                            <form method="post" action="{% url 'add_to_cart' related_first_variant.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ related.id }}">
                                <input type="hidden" name="quantity" value="1">
                                <button type="submit" class="w-full bg-primary text-white py-2 px-3 rounded-md font-semibold hover:bg-primary-dark transition-all text-xs transform hover:scale-105 flex items-center justify-center space-x-1.5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                    <span>Add</span>
                                </button>
                            </form>
                            <a href="{% url 'product_detail' related.slug %}" class="block text-center w-full bg-secondary text-white py-2 px-3 rounded-md font-semibold hover:bg-secondary-dark transition-all text-xs transform hover:scale-105">View</a>
                        </div>
                    </div>
                    {% endwith %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </main>

    <footer class="bg-neutral-darker text-gray-300 mt-20 py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                <div>
                    <h3 class="text-2xl font-bold text-primary mb-4">GnanowShop</h3>
                    <p class="text-sm text-gray-400 leading-relaxed">Discover amazing products with Gnanow. Quality and value, delivered to your doorstep.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Shop</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="{% url 'product_list' %}" class="text-gray-400 hover:text-primary transition-colors">All Products</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">New Arrivals</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Best Sellers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Sales & Offers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Customer Service</h4>
                    <ul class="space-y-2.5 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">FAQs</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Shipping Information</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-colors">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Facebook"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Twitter"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors" aria-label="Instagram"><svg viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.272.058 2.166.248 2.914.552.782.317 1.41.707 2.062 1.358.65.651 1.04 1.28 1.357 2.062.304.748.494 1.642.552 2.914.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.058 1.272-.248 2.166-.552 2.914-.317.782-.707 1.41-1.358 2.062-.651.65-1.28 1.04-2.062 1.357-.748.304-1.642.494-2.914.552-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.272-.058-2.166-.248-2.914-.552-.782-.317-1.41-.707-2.062-1.358-.65-.651-1.04-1.28-1.357-2.062-.304-.748-.494-1.642-.552-2.914-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.058-1.272.248-2.166.552-2.914.317-.782.707-1.41 1.358-2.062.651-.65 1.28-1.04 2.062-1.357.748-.304 1.642-.494 2.914-.552A17.936 17.936 0 0012 3.965zm0 1.802c-3.144 0-3.502.012-4.728.068-1.186.054-1.91.23-2.448.444-.586.236-.99.56-1.42.99-.43.43-.754.834-.99 1.42-.213.538-.39 1.262-.443 2.448C2.012 8.498 2 8.856 2 12s.012 3.502.068 4.728c.054 1.186.23 1.91.443 2.448.236.586.56.99.99 1.42.43.43.834.754 1.42.99.538.213 1.262.39 2.448.443C8.498 21.988 8.856 22 12 22s3.502-.012 4.728-.068c1.186-.054 1.91-.23 2.448-.443.586-.236.99-.56 1.42-.99.43-.43.754-.834.99-1.42.213-.538.39-1.262.443-2.448.056-1.226.068-1.584.068-4.728s-.012-3.502-.068-4.728c-.054-1.186-.23-1.91-.443-2.448-.236-.586-.56-.99-.99-1.42-.43-.43-.834-.754-1.42-.99-.538-.213-1.262-.39-2.448-.443A16.145 16.145 0 0012 3.965zm0 2.98c-2.761 0-5 2.239-5 5s2.239 5 5 5 5-2.239 5-5-2.239-5-5-5zm0 8.15c-1.737 0-3.15-1.413-3.15-3.15s1.413-3.15 3.15-3.15 3.15 1.413 3.15 3.15-1.413 3.15-3.15 3.15zm5.25-8.093c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25z"></path></svg></a>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; {% now "Y" %} GnanowShop. All rights reserved.</p>
                <p class="mt-1 text-gray-500">Designed with <span class="text-red-500 animate-pulse-sm">♥</span> by Gnanow AI & Tailwind CSS.</p>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const colorSelect = document.getElementById('color');
        const sizeSelect = document.getElementById('size');

        const variants = {{ variant_json|safe }};

        function reloadWithVariant() {
            const color = colorSelect.value;
            const size = sizeSelect.value;

            const match = variants.find(v => v.color === color && v.size === size);
            if (match) {
                const url = new URL(window.location.href);
                url.searchParams.set('variant_id', match.id);
                window.location.href = url.toString();
            }
        }

        colorSelect.addEventListener('change', reloadWithVariant);
        sizeSelect.addEventListener('change', reloadWithVariant);
    });
</script>

</body>
</html>



